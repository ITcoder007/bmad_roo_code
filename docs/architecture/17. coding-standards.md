# Coding Standards

## Critical Fullstack Rules

- **Type Sharing**: Always define types in packages/shared and import from there
- **API Calls**: Never make direct HTTP calls - use the service layer
- **Environment Variables**: Access only through config objects, never process.env directly
- **Error Handling**: All API routes must use the standard error handler
- **State Updates**: Never mutate state directly - use proper state management patterns
- **Certificate Data Validation**: All certificate data must be validated before storage
- **Date Handling**: Always use UTC for certificate expiry dates and convert to local time for display
- **Security**: Never expose sensitive certificate information in logs or error messages
- **Database Access**: All database operations must go through the repository layer
- **Frontend Components**: All components must have proper TypeScript props and emit interfaces

## Naming Conventions

| Element | Frontend | Backend | Example |
|---------|----------|---------|---------|
| Components | PascalCase | - | `UserProfile.tsx` |
| Hooks | camelCase with 'use' | - | `useAuth.ts` |
| API Routes | - | kebab-case | `/api/user-profile` |
| Database Tables | - | snake_case | `user_profiles` |
| Certificate Fields | camelCase | snake_case | `expiryDate` / `expiry_date` |
| Services | camelCase | PascalCase | `certificateService` / `CertificateService` |
| Constants | UPPER_SNAKE_CASE | UPPER_SNAKE_CASE | `MAX_CERTIFICATES` |
| Interfaces | PascalCase | PascalCase | `ICertificate` |
| Types | PascalCase | PascalCase | `CertificateStatus` |

## Rationale

1. **Type Sharing**: 在全栈项目中，前后端共享类型定义可以确保数据一致性，减少类型不匹配导致的错误。将所有类型定义放在 `packages/shared` 目录中，可以方便地在前后端之间共享和重用。

2. **API Calls**: 通过服务层统一管理 API 调用，可以集中处理认证、错误处理、缓存等横切关注点，避免在组件中直接进行 HTTP 调用导致的代码重复和维护困难。

3. **Environment Variables**: 通过配置对象访问环境变量，而不是直接使用 `process.env`，可以提供更好的类型安全性和集中管理，避免环境变量名称拼写错误或遗漏。

4. **Error Handling**: 统一的错误处理机制可以确保系统中的错误信息一致，便于调试和用户反馈。对于证书管理系统，准确的错误信息尤为重要，因为证书问题可能直接影响业务连续性。

5. **State Updates**: 正确的状态管理模式可以避免状态不一致和难以追踪的 bug。在证书管理系统中，状态的一致性对于证书状态的准确计算和显示至关重要。

6. **Certificate Data Validation**: 证书数据的准确性是系统的核心，所有证书数据在存储前必须进行验证，确保数据的完整性和有效性，防止无效数据导致系统错误。

7. **Date Handling**: 证书到期时间是系统的关键数据，使用 UTC 标准时间存储可以避免时区问题，只在显示时转换为本地时间，确保时间计算的一致性。

8. **Security**: 证书信息包含敏感数据，绝不能在日志或错误消息中暴露，防止安全漏洞。这是证书管理系统的基本安全要求。

9. **Database Access**: 通过仓库层统一管理数据库访问，可以集中处理数据访问逻辑、事务管理和缓存策略，提高代码的可维护性和可测试性。

10. **Frontend Components**: 前端组件必须具有正确的 TypeScript 属性和发出接口，以确保类型安全和组件间的正确通信，减少运行时错误。

这些编码标准专门针对证书生命周期管理系统的特点制定，重点关注数据一致性、安全性和可维护性，确保系统的稳定性和可靠性。