# Testing Strategy

## Testing Pyramid

```
                  E2E Tests
                 /        \
            Integration Tests
               /            \
          Frontend Unit  Backend Unit
```

## Test Organization

### Frontend Tests

```
frontend/
├── src/
│   ├── __tests__/
│   │   ├── components/     # 组件测试
│   │   ├── pages/          # 页面测试
│   │   ├── hooks/          # 自定义钩子测试
│   │   ├── services/       # 服务层测试
│   │   └── utils/          # 工具函数测试
│   └── tests/
│       ├── integration/    # 集成测试
│       └── e2e/           # 端到端测试
```

### Backend Tests

```
backend/
├── src/
│   ├── test/
│   │   ├── unit/           # 单元测试
│   │   │   ├── services/   # 服务层测试
│   │   │   ├── controllers/# 控制器测试
│   │   │   ├── models/     # 模型测试
│   │   │   └── utils/      # 工具函数测试
│   │   ├── integration/    # 集成测试
│   │   └── api/           # API测试
```

### E2E Tests

```
tests/
├── e2e/
│   ├── specs/             # 测试规格
│   ├── support/           # 支持文件
│   └── fixtures/          # 测试数据
```

## Test Examples

### Frontend Component Test

```typescript
// 证书列表组件测试
import { render, screen } from '@testing-library/vue';
import CertificateList from '@/components/CertificateList.vue';
import { mockCertificates } from '@/__mocks__/certificates';

describe('CertificateList', () => {
  it('renders certificates correctly', () => {
    render(CertificateList, {
      props: {
        certificates: mockCertificates
      }
    });
    
    expect(screen.getByText('证书名称1')).toBeInTheDocument();
    expect(screen.getByText('example.com')).toBeInTheDocument();
  });

  it('filters certificates by status', async () => {
    render(CertificateList, {
      props: {
        certificates: mockCertificates
      }
    });
    
    const statusFilter = screen.getByLabelText('状态筛选');
    await fireEvent.update(statusFilter, '即将过期');
    
    expect(screen.getByText('证书名称2')).toBeInTheDocument();
    expect(screen.queryByText('证书名称1')).not.toBeInTheDocument();
  });
});
```

### Backend API Test

```typescript
// 证书管理API测试
import request from 'supertest';
import app from '@/app';
import { Certificate } from '@/models/Certificate';

describe('Certificate API', () => {
  it('GET /api/certificates - 获取证书列表', async () => {
    const response = await request(app)
      .get('/api/certificates')
      .expect(200);
    
    expect(Array.isArray(response.body)).toBe(true);
    expect(response.body.length).toBeGreaterThan(0);
  });

  it('POST /api/certificates - 创建新证书', async () => {
    const newCertificate = {
      name: '测试证书',
      domain: 'test.example.com',
      issuer: '测试颁发机构',
      expiryDate: '2024-12-31',
      type: 'SSL'
    };
    
    const response = await request(app)
      .post('/api/certificates')
      .send(newCertificate)
      .expect(201);
    
    expect(response.body.name).toBe(newCertificate.name);
    expect(response.body.id).toBeDefined();
  });

  it('GET /api/certificates/:id - 获取单个证书', async () => {
    const certificate = await Certificate.findOne();
    const response = await request(app)
      .get(`/api/certificates/${certificate.id}`)
      .expect(200);
    
    expect(response.body.id).toBe(certificate.id);
    expect(response.body.name).toBe(certificate.name);
  });
});
```

### E2E Test

```typescript
// 证书管理端到端测试
describe('证书管理流程', () => {
  it('用户可以添加、查看和删除证书', () => {
    cy.visit('/certificates');
    
    // 添加新证书
    cy.get('[data-testid="add-certificate-btn"]').click();
    cy.get('[name="name"]').type('E2E测试证书');
    cy.get('[name="domain"]').type('e2e.example.com');
    cy.get('[name="issuer"]').type('E2E颁发机构');
    cy.get('[name="expiryDate"]').type('2024-12-31');
    cy.get('[name="type"]').select('SSL');
    cy.get('[data-testid="save-btn"]').click();
    
    // 验证证书已添加
    cy.contains('E2E测试证书').should('be.visible');
    cy.contains('e2e.example.com').should('be.visible');
    
    // 查看证书详情
    cy.contains('E2E测试证书').click();
    cy.url().should('include', '/certificates/');
    cy.contains('E2E颁发机构').should('be.visible');
    
    // 返回列表并删除证书
    cy.go('back');
    cy.contains('E2E测试证书')
      .parents('[data-testid="certificate-row"]')
      .find('[data-testid="delete-btn"]')
      .click();
    
    // 确认删除
    cy.get('[data-testid="confirm-delete"]').click();
    
    // 验证证书已删除
    cy.contains('E2E测试证书').should('not.exist');
  });
});
```

## Rationale

1. **测试金字塔结构**：选择了经典的测试金字塔模型，在底层有大量的单元测试，中间有适量的集成测试，顶部有少量的端到端测试。这种结构能够平衡测试覆盖率和维护成本，确保系统的各个层面都得到充分测试。

2. **测试组织结构**：根据 PRD 中提到的技术栈（Vue.js 前端和 Spring Boot 后端），设计了相应的测试目录结构。前端测试使用 Vue Test Utils 和 Vitest，后端测试使用 JUnit 和 Spring Test，E2E 测试使用 Cypress。

3. **测试覆盖重点**：基于 PRD 中的功能需求（证书信息管理、证书监控和预警、统一管理界面、预警通知），确保测试覆盖了这些核心功能，特别是证书的 CRUD 操作、状态计算和筛选功能。

4. **测试示例选择**：选择了证书列表组件、证书管理 API 和完整的证书管理流程作为测试示例，这些是系统的核心功能，能够有效验证系统的正确性和稳定性。

5. **测试策略符合 MVP 要求**：根据 PRD 中的 MVP 验证方法，测试策略支持功能验证、性能验证、用户验收测试和业务价值验证各个阶段的需求。特别是针对 PRD 中提到的"证书过期预警准确率达到90%以上"和"系统可用性达到99%"等关键指标，设计了相应的测试用例。

6. **测试工具选择**：基于 PRD 中提到的技术假设，选择了适合的技术栈测试工具。前端使用 Vitest 和 Vue Test Utils，后端使用 JUnit 和 Mockito，E2E 测试使用 Cypress，这些工具与项目的技术栈高度匹配，能够提供全面的测试覆盖。

7. **测试数据管理**：测试示例中包含了模拟数据和测试夹具的使用，确保测试的独立性和可重复性。这对于证书管理系统尤为重要，因为证书数据具有时效性和状态变化的特点。

8. **用户流程覆盖**：E2E 测试设计覆盖了 PRD 中描述的主要用户流程，包括证书管理流程、证书监控与预警处理流程和证书状态查看与搜索流程，确保系统从用户角度的功能完整性。