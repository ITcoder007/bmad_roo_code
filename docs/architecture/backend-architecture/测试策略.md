# 测试策略

## 1. 单元测试

- **JUnit 5**：使用JUnit 5作为单元测试框架
- **Mockito**：使用Mockito模拟依赖对象
- **测试覆盖**：确保核心业务逻辑的测试覆盖率达到80%以上
- **测试示例**：
  ```java
  @ExtendWith(MockitoExtension.class)
  class CertificateServiceTest {
      
      @Mock
      private CertificateRepository certificateRepository;
      
      @Mock
      private MonitoringLogService monitoringLogService;
      
      @InjectMocks
      private CertificateServiceImpl certificateService;
      
      @Test
      void findById_shouldReturnCertificate() {
          // Given
          Long certificateId = 1L;
          Certificate certificate = new Certificate();
          certificate.setId(certificateId);
          certificate.setName("Test Certificate");
          
          when(certificateRepository.findById(certificateId)).thenReturn(Optional.of(certificate));
          
          // When
          Optional<Certificate> result = certificateService.findById(certificateId);
          
          // Then
          assertTrue(result.isPresent());
          assertEquals(certificateId, result.get().getId());
          assertEquals("Test Certificate", result.get().getName());
          verify(certificateRepository).findById(certificateId);
      }
      
      // 其他测试方法...
  }
  ```

## 2. 集成测试

- **Spring Boot Test**：使用Spring Boot Test进行集成测试
- **测试数据库**：使用H2内存数据库进行测试
- **测试示例**：
  ```java
  @SpringBootTest
  @AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
  @TestPropertySource(properties = {
      "spring.datasource.url=jdbc:h2:mem:testdb",
      "spring.datasource.driver-class-name=org.h2.Driver",
      "spring.datasource.username=sa",
      "spring.datasource.password=password",
      "spring.jpa.database-platform=org.hibernate.dialect.H2Dialect"
  })
  class CertificateControllerIntegrationTest {
      
      @Autowired
      private MockMvc mockMvc;
      
      @Autowired
      private CertificateRepository certificateRepository;
      
      @Test
      void getAllCertificates_shouldReturnCertificateList() throws Exception {
          // Given
          Certificate certificate = new Certificate();
          certificate.setName("Test Certificate");
          certificate.setDomain("example.com");
          certificateRepository.save(certificate);
          
          // When & Then
          mockMvc.perform(get("/api/v1/certificates"))
              .andExpect(status().isOk())
              .andExpect(jsonPath("$.success").value(true))
              .andExpect(jsonPath("$.data.content[0].name").value("Test Certificate"));
      }
      
      // 其他测试方法...
  }
  ```

## 3. 端到端测试

- **Postman**：使用Postman进行API端到端测试
- **测试场景**：覆盖主要的业务流程和边界情况
- **测试自动化**：使用Postman的集合和测试脚本实现自动化测试
