# 分层架构

## 1. 分层架构图

```mermaid
graph TB
    subgraph "表现层 (Presentation Layer)"
        C1[CertificateController]
        C2[MonitoringLogController]
        C3[SystemController]
    end
    
    subgraph "应用层 (Application Layer)"
        S1[CertificateService]
        S2[MonitoringLogService]
        S3[MonitoringService]
        S4[AlertService]
        S5[SystemStatusService]
    end
    
    subgraph "领域层 (Domain Layer)"
        D1[Certificate]
        D2[MonitoringLog]
        D3[CertificateRepository]
        D4[MonitoringLogRepository]
        D5[CertificateDomainService]
        D6[MonitoringDomainService]
    end
    
    subgraph "基础设施层 (Infrastructure Layer)"
        I1[CertificateRepositoryImpl]
        I2[MonitoringLogRepositoryImpl]
        I3[CertificateEntity]
        I4[MonitoringLogEntity]
        I5[EmailService]
        I6[SmsService]
        I7[CertificateValidationService]
        I8[CertificateScheduler]
    end
    
    subgraph "外部系统 (External Systems)"
        E1[MySQL Database]
        E2[Email Provider]
        E3[SMS Provider]
        E4[Certificate Validation Service]
    end
    
    C1 --> S1
    C2 --> S2
    C3 --> S3
    C3 --> S5
    
    S1 --> D1
    S1 --> D5
    S2 --> D2
    S2 --> D6
    S3 --> D1
    S3 --> D2
    S3 --> D6
    S4 --> D2
    S4 --> D6
    S5 --> D1
    S5 --> D2
    
    D1 --> D3
    D2 --> D4
    D5 --> D1
    D6 --> D2
    
    D3 --> I1
    D4 --> I2
    
    I1 --> I3
    I2 --> I4
    I1 --> E1
    I2 --> E1
    
    S4 --> I5
    S4 --> I6
    S3 --> I7
    
    I5 --> E2
    I6 --> E3
    I7 --> E4
    
    S3 --> I8
```

## 2. 分层职责

- **表现层 (Presentation Layer)**：
  - 负责处理HTTP请求和响应
  - 验证输入参数
  - 调用应用层服务处理业务逻辑
  - 返回统一的API响应格式

- **应用层 (Application Layer)**：
  - 实现应用业务用例
  - 协调领域对象和基础设施服务
  - 处理事务边界
  - 提供DTO和VO之间的转换

- **领域层 (Domain Layer)**：
  - 包含核心业务逻辑和领域模型
  - 定义领域实体、值对象和领域服务
  - 定义仓库接口，不关心具体实现
  - 发布领域事件

- **基础设施层 (Infrastructure Layer)**：
  - 实现仓库接口，提供数据持久化
  - 集成外部系统和服务
  - 提供技术基础设施支持
  - 实现横切关注点（如日志、缓存）
