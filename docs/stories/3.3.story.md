# Story 3.3: åŸºç¡€æœç´¢åŠŸèƒ½

## Status
âœ… **Completed** - 2025-08-17

## Story
**As a** å‰ç«¯å¼€å‘äººå‘˜,
**I want** å®ç°åŸºç¡€çš„è¯ä¹¦æœç´¢åŠŸèƒ½,
**so that** ç”¨æˆ·èƒ½å¤Ÿå¿«é€Ÿæ‰¾åˆ°æ‰€éœ€è¯ä¹¦.

## Acceptance Criteria
1. å®ç°æœç´¢æ¡†ç»„ä»¶ï¼Œæ”¯æŒè¾“å…¥æœç´¢å…³é”®è¯
2. å®ç°æŒ‰è¯ä¹¦åç§°å’ŒåŸŸåçš„æœç´¢åŠŸèƒ½
3. æ·»åŠ æœç´¢æŒ‰é’®ï¼Œæ”¯æŒæ‰‹åŠ¨è§¦å‘æœç´¢
4. å®ç°æœç´¢ç»“æœçš„å®æ—¶å±•ç¤º
5. æ·»åŠ æ¸…é™¤æœç´¢çš„åŠŸèƒ½
6. ç¡®ä¿æœç´¢åŠŸèƒ½çš„å“åº”æ—¶é—´ä¸è¶…è¿‡1ç§’
7. åœ¨æœç´¢ç»“æœä¸­é«˜äº®åŒ¹é…çš„å…³é”®è¯

## Tasks / Subtasks

- [x] Task 1: åˆ›å»ºæœç´¢ç»„ä»¶åŸºç¡€ç»“æ„ (AC: 1, 3, 5) âœ… **å®Œæˆ**
  - [x] Subtask 1.1: åœ¨ `frontend/src/components/business/CertificateSearchBox.vue` ä¸­åˆ›å»ºæœç´¢æ¡†ç»„ä»¶
  - [x] Subtask 1.2: ä½¿ç”¨ Element Plus Input ç»„ä»¶å®ç°æœç´¢è¾“å…¥æ¡†
  - [x] Subtask 1.3: æ·»åŠ æœç´¢æŒ‰é’®å’Œæ¸…é™¤æŒ‰é’®ï¼Œä½¿ç”¨ Element Plus å›¾æ ‡
  - [x] Subtask 1.4: å®ç°ç»„ä»¶çš„ props å’Œ emits æ¥å£å®šä¹‰

- [x] Task 2: å®ç°æœç´¢é€»è¾‘å’Œé˜²æŠ–åŠŸèƒ½ (AC: 2, 4, 6) âœ… **å®Œæˆ**
  - [x] Subtask 2.1: å®ç°é˜²æŠ–æœç´¢åŠŸèƒ½ï¼Œä½¿ç”¨ useDebounce ç»„åˆå‡½æ•°
  - [x] Subtask 2.2: åœ¨è¯ä¹¦åˆ—è¡¨é¡µé¢é›†æˆæœç´¢ç»„ä»¶
  - [x] Subtask 2.3: æ‰©å±•è¯ä¹¦ store æ·»åŠ æœç´¢çŠ¶æ€ç®¡ç†
  - [x] Subtask 2.4: å®ç°æœç´¢å‚æ•°ä¸åˆ—è¡¨ç­›é€‰çš„é›†æˆ

- [x] Task 3: å®ç°æœç´¢ç»“æœé«˜äº®æ˜¾ç¤º (AC: 7) âœ… **å®Œæˆ**
  - [x] Subtask 3.1: åˆ›å»ºæ–‡æœ¬é«˜äº®å·¥å…·å‡½æ•° `frontend/src/utils/highlight.js`
  - [x] Subtask 3.2: åœ¨è¯ä¹¦åˆ—è¡¨ç»„ä»¶ä¸­é›†æˆé«˜äº®æ˜¾ç¤ºåŠŸèƒ½
  - [x] Subtask 3.3: ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å®ç°å…³é”®è¯åŒ¹é…å’Œé«˜äº®
  - [x] Subtask 3.4: æ·»åŠ é«˜äº®æ ·å¼ï¼Œä½¿ç”¨é†’ç›®çš„èƒŒæ™¯è‰²

- [x] Task 4: é›†æˆåç«¯æœç´¢API (AC: 2, 6) âœ… **å®Œæˆ**
  - [x] Subtask 4.1: æ‰©å±• `frontend/src/api/certificate.js` æ·»åŠ æœç´¢å‚æ•°æ”¯æŒ
  - [x] Subtask 4.2: ä¿®æ”¹ getCertificateList API è°ƒç”¨ï¼Œæ”¯æŒ search å‚æ•°
  - [x] Subtask 4.3: å®ç°æœç´¢çŠ¶æ€çš„ URL åŒæ­¥ï¼Œæ”¯æŒæµè§ˆå™¨å‰è¿›åé€€
  - [x] Subtask 4.4: æ·»åŠ æœç´¢ç»“æœçš„åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†

- [x] Task 5: ä¼˜åŒ–ç”¨æˆ·ä½“éªŒå’Œäº¤äº’ (AC: 3, 4, 5) âœ… **å®Œæˆ**
  - [x] Subtask 5.1: å®ç°æœç´¢å¿«æ·é”®æ”¯æŒï¼ˆEnter é”®æœç´¢ï¼ŒEscape é”®æ¸…é™¤ï¼‰
  - [x] Subtask 5.2: æ·»åŠ æœç´¢å†å²è®°å½•åŠŸèƒ½ï¼ˆä½¿ç”¨ localStorageï¼‰
  - [x] Subtask 5.3: å®ç°æœç´¢å»ºè®®å’Œè‡ªåŠ¨å®Œæˆï¼ˆå¯é€‰ï¼‰
  - [x] Subtask 5.4: æ·»åŠ æœç´¢ç»“æœæ•°é‡æ˜¾ç¤ºå’Œç©ºçŠ¶æ€å¤„ç†

- [x] Task 6: ç¼–å†™æµ‹è¯•ç”¨ä¾‹ (AC: 1-7) âœ… **å®Œæˆ**
  - [x] Subtask 6.1: åˆ›å»º `frontend/tests/unit/components/business/CertificateSearchBox.spec.js` æµ‹è¯•æ–‡ä»¶
  - [x] Subtask 6.2: ç¼–å†™æœç´¢ç»„ä»¶æ¸²æŸ“å’Œäº¤äº’çš„æµ‹è¯•ç”¨ä¾‹
  - [x] Subtask 6.3: ç¼–å†™é˜²æŠ–åŠŸèƒ½å’Œæœç´¢è§¦å‘çš„æµ‹è¯•ç”¨ä¾‹
  - [x] Subtask 6.4: ç¼–å†™é«˜äº®æ˜¾ç¤ºåŠŸèƒ½çš„æµ‹è¯•ç”¨ä¾‹
  - [x] Subtask 6.5: ç¼–å†™æœç´¢é›†æˆæµ‹è¯•ï¼ŒåŒ…å«APIè°ƒç”¨å’ŒçŠ¶æ€æ›´æ–°
  - [x] Subtask 6.6: ç¼–å†™å·¥å…·å‡½æ•°æµ‹è¯• `frontend/tests/unit/utils/highlight.spec.js`

## Dev Notes

### å‰ä¸€ä¸ªæ•…äº‹çš„å…³é”®ä¿¡æ¯
åŸºäº [Source: docs/stories/3.2.story.md#Dev Agent Record]ï¼š
- è¯ä¹¦è¯¦æƒ…é¡µé¢å·²å®Œæˆï¼ŒåŒ…å«å®Œæ•´çš„çŠ¶æ€ç®¡ç†å’Œç»„ä»¶æ¶æ„
- CertificateStatusBadge ç»„ä»¶å·²å®ç°ï¼Œå¯å¤ç”¨äºæœç´¢ç»“æœå±•ç¤º
- è¯ä¹¦çŠ¶æ€ç®¡ç†(certificate store)å·²å®Œå–„ï¼Œæ”¯æŒ CRUD æ“ä½œå’ŒçŠ¶æ€è®¡ç®—
- BaseTableã€BaseDialogã€Loading ç­‰é€šç”¨ç»„ä»¶å·²å¯ç”¨
- å·¥å…·å‡½æ•° date.js å·²å®ç°ï¼Œæä¾›æ—¥æœŸæ ¼å¼åŒ–åŠŸèƒ½

### æŠ€æœ¯æ ˆé…ç½®
æ ¹æ® [Source: architecture/3.tech-stack.md]ï¼š

**å‰ç«¯æŠ€æœ¯æ ˆï¼ˆå¿…é¡»ä½¿ç”¨ï¼‰ï¼š**
- Vue.js 3.x - å“åº”å¼ç”¨æˆ·ç•Œé¢æ¡†æ¶
- Vue Router 4.x - å‰ç«¯è·¯ç”±ç®¡ç†
- Pinia 2.x - çŠ¶æ€ç®¡ç†
- Element Plus 2.x - UI ç»„ä»¶åº“
- Vite 4.x - æ„å»ºå·¥å…·
- JavaScript ES2020+ - å¼€å‘è¯­è¨€
- Vitest 1.x + Vue Test Utils 2.x - æµ‹è¯•æ¡†æ¶

### é¡¹ç›®ç»“æ„
æ ¹æ® [Source: architecture/12.unified-project-structure.md]ï¼š

**æœç´¢åŠŸèƒ½ç›¸å…³æ–‡ä»¶ä½ç½®ï¼š**
```
frontend/src/
â”œâ”€â”€ views/certificate/
â”‚   â””â”€â”€ CertificateList.vue              # è¯ä¹¦åˆ—è¡¨é¡µé¢ï¼ˆéœ€è¦é›†æˆæœç´¢ç»„ä»¶ï¼‰
â”œâ”€â”€ components/business/
â”‚   â”œâ”€â”€ CertificateSearchBox.vue         # æœç´¢æ¡†ç»„ä»¶ï¼ˆæ–°å»ºï¼‰
â”‚   â””â”€â”€ CertificateStatusBadge.vue       # è¯ä¹¦çŠ¶æ€å¾½ç« ç»„ä»¶ï¼ˆå·²å­˜åœ¨ï¼Œå¯å¤ç”¨ï¼‰
â”œâ”€â”€ stores/modules/
â”‚   â””â”€â”€ certificate.js                   # è¯ä¹¦çŠ¶æ€ç®¡ç†ï¼ˆéœ€è¦æ‰©å±•æœç´¢åŠŸèƒ½ï¼‰
â”œâ”€â”€ api/
â”‚   â””â”€â”€ certificate.js                   # è¯ä¹¦APIæ¥å£ï¼ˆéœ€è¦æ‰©å±•æœç´¢å‚æ•°ï¼‰
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ date.js                          # æ—¥æœŸå·¥å…·ï¼ˆå·²å­˜åœ¨ï¼‰
â”‚   â””â”€â”€ highlight.js                     # æ–‡æœ¬é«˜äº®å·¥å…·ï¼ˆæ–°å»ºï¼‰
â”œâ”€â”€ composables/
â”‚   â””â”€â”€ useDebounce.js                   # é˜²æŠ–ç»„åˆå‡½æ•°ï¼ˆå·²å­˜åœ¨ï¼‰
â””â”€â”€ router/modules/
    â””â”€â”€ certificate.js                   # è¯ä¹¦è·¯ç”±æ¨¡å—ï¼ˆå·²å­˜åœ¨ï¼‰
```

### å‰ç«¯æ¶æ„è®¾è®¡
æ ¹æ® [Source: architecture/10.frontend-architecture.md]ï¼š

**Vue 3 ç»„åˆå¼APIæœç´¢ç»„ä»¶ç»“æ„ï¼š**
```javascript
// CertificateSearchBox.vue ç»„ä»¶ç»“æ„ç¤ºä¾‹
<template>
  <div class="certificate-search-box">
    <el-input
      v-model="searchQuery"
      placeholder="æœç´¢è¯ä¹¦åç§°æˆ–åŸŸå..."
      clearable
      @clear="handleClear"
      @keydown.enter="handleSearch"
      @keydown.escape="handleClear"
      class="search-input"
    >
      <template #suffix>
        <el-button 
          type="primary" 
          :icon="Search" 
          @click="handleSearch"
          :loading="loading"
          class="search-button"
        >
          æœç´¢
        </el-button>
      </template>
    </el-input>
    
    <!-- æœç´¢å†å² -->
    <div v-if="showHistory && searchHistory.length > 0" class="search-history">
      <div class="history-header">
        <span>æœç´¢å†å²</span>
        <el-button type="text" @click="clearHistory">æ¸…é™¤å†å²</el-button>
      </div>
      <div class="history-items">
        <el-tag
          v-for="(item, index) in searchHistory"
          :key="index"
          @click="selectHistoryItem(item)"
          closable
          @close="removeHistoryItem(index)"
          class="history-tag"
        >
          {{ item }}
        </el-tag>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, watch, onMounted } from 'vue'
import { Search } from '@element-plus/icons-vue'
import { useDebounce } from '@/composables/useDebounce'

// Props
const props = defineProps({
  modelValue: {
    type: String,
    default: ''
  },
  loading: {
    type: Boolean,
    default: false
  },
  placeholder: {
    type: String,
    default: 'æœç´¢è¯ä¹¦åç§°æˆ–åŸŸå...'
  }
})

// Emits
const emit = defineEmits(['update:modelValue', 'search', 'clear'])

// å“åº”å¼æ•°æ®
const searchQuery = ref(props.modelValue)
const showHistory = ref(false)
const searchHistory = ref([])

// é˜²æŠ–æœç´¢
const debouncedSearch = useDebounce((query) => {
  if (query.trim()) {
    emit('search', query.trim())
    addToHistory(query.trim())
  }
}, 300)

// è®¡ç®—å±æ€§
const trimmedQuery = computed(() => searchQuery.value?.trim() || '')

// æ–¹æ³•
const handleSearch = () => {
  if (trimmedQuery.value) {
    emit('search', trimmedQuery.value)
    addToHistory(trimmedQuery.value)
    showHistory.value = false
  }
}

const handleClear = () => {
  searchQuery.value = ''
  emit('update:modelValue', '')
  emit('clear')
  showHistory.value = false
}

const addToHistory = (query) => {
  if (!searchHistory.value.includes(query)) {
    searchHistory.value.unshift(query)
    if (searchHistory.value.length > 10) {
      searchHistory.value = searchHistory.value.slice(0, 10)
    }
    saveHistoryToStorage()
  }
}

const selectHistoryItem = (item) => {
  searchQuery.value = item
  emit('update:modelValue', item)
  emit('search', item)
  showHistory.value = false
}

const removeHistoryItem = (index) => {
  searchHistory.value.splice(index, 1)
  saveHistoryToStorage()
}

const clearHistory = () => {
  searchHistory.value = []
  saveHistoryToStorage()
  showHistory.value = false
}

const loadHistoryFromStorage = () => {
  try {
    const history = localStorage.getItem('certificate-search-history')
    if (history) {
      searchHistory.value = JSON.parse(history)
    }
  } catch (error) {
    console.warn('Failed to load search history:', error)
  }
}

const saveHistoryToStorage = () => {
  try {
    localStorage.setItem('certificate-search-history', JSON.stringify(searchHistory.value))
  } catch (error) {
    console.warn('Failed to save search history:', error)
  }
}

// ç›‘å¬å™¨
watch(
  () => props.modelValue,
  (newValue) => {
    searchQuery.value = newValue
  }
)

watch(searchQuery, (newValue) => {
  emit('update:modelValue', newValue)
  if (newValue.trim()) {
    debouncedSearch(newValue)
  }
})

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  loadHistoryFromStorage()
})
</script>

<style scoped>
.certificate-search-box {
  position: relative;
  width: 100%;
  max-width: 400px;
}

.search-input {
  width: 100%;
}

.search-button {
  margin-left: 8px;
  border-radius: 0 4px 4px 0;
}

.search-history {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: white;
  border: 1px solid #dcdfe6;
  border-radius: 4px;
  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
  z-index: 1000;
  margin-top: 4px;
  padding: 12px;
}

.history-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  font-size: 12px;
  color: #909399;
}

.history-items {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.history-tag {
  cursor: pointer;
  transition: all 0.2s;
}

.history-tag:hover {
  background-color: #ecf5ff;
  border-color: #409eff;
}
</style>
```

### æ–‡æœ¬é«˜äº®å·¥å…·å‡½æ•°
æ ¹æ® [Source: architecture/12.unified-project-structure.md#å‰ç«¯å·¥å…·å‡½æ•°]ï¼š

**é«˜äº®å·¥å…·å‡½æ•°è®¾è®¡ï¼š**
```javascript
// utils/highlight.js
/**
 * é«˜äº®åŒ¹é…çš„æ–‡æœ¬
 * @param {string} text - åŸå§‹æ–‡æœ¬
 * @param {string} keyword - æœç´¢å…³é”®è¯
 * @param {string} className - é«˜äº®æ ·å¼ç±»å
 * @returns {string} åŒ…å«é«˜äº®æ ‡ç­¾çš„HTMLå­—ç¬¦ä¸²
 */
export function highlightText(text, keyword, className = 'highlight') {
  if (!text || !keyword) return text
  
  try {
    // è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
    const escapedKeyword = keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')
    const regex = new RegExp(`(${escapedKeyword})`, 'gi')
    
    return text.replace(regex, `<span class="${className}">$1</span>`)
  } catch (error) {
    console.warn('Failed to highlight text:', error)
    return text
  }
}

/**
 * é«˜äº®å¤šä¸ªå…³é”®è¯
 * @param {string} text - åŸå§‹æ–‡æœ¬
 * @param {string[]} keywords - æœç´¢å…³é”®è¯æ•°ç»„
 * @param {string} className - é«˜äº®æ ·å¼ç±»å
 * @returns {string} åŒ…å«é«˜äº®æ ‡ç­¾çš„HTMLå­—ç¬¦ä¸²
 */
export function highlightMultipleKeywords(text, keywords, className = 'highlight') {
  if (!text || !keywords || keywords.length === 0) return text
  
  let result = text
  keywords.forEach(keyword => {
    if (keyword.trim()) {
      result = highlightText(result, keyword.trim(), className)
    }
  })
  
  return result
}

/**
 * æ£€æŸ¥æ–‡æœ¬æ˜¯å¦åŒ…å«å…³é”®è¯
 * @param {string} text - åŸå§‹æ–‡æœ¬
 * @param {string} keyword - æœç´¢å…³é”®è¯
 * @returns {boolean} æ˜¯å¦åŒ…å«å…³é”®è¯
 */
export function containsKeyword(text, keyword) {
  if (!text || !keyword) return false
  
  return text.toLowerCase().includes(keyword.toLowerCase())
}
```

### çŠ¶æ€ç®¡ç†æ‰©å±•
æ ¹æ® [Source: architecture/10.frontend-architecture.md#çŠ¶æ€ç®¡ç†]ï¼š

**Certificate Store æœç´¢åŠŸèƒ½æ‰©å±•ï¼š**
```javascript
// stores/modules/certificate.js
export const useCertificateStore = defineStore('certificate', {
  state: () => ({
    // ç°æœ‰çŠ¶æ€...
    certificates: [],
    currentCertificate: null,
    loading: false,
    
    // æ–°å¢æœç´¢ç›¸å…³çŠ¶æ€
    searchQuery: '',
    searchLoading: false,
    searchResults: [],
    filteredCertificates: [],
    
    // åˆ†é¡µå’Œç­›é€‰çŠ¶æ€
    pagination: {
      page: 1,
      size: 20,
      total: 0
    },
    filters: {
      status: '',
      search: ''
    }
  }),

  getters: {
    // ç°æœ‰getters...
    
    // æœç´¢ç›¸å…³getters
    hasSearchQuery: (state) => state.searchQuery.trim() !== '',
    
    searchResultsCount: (state) => state.searchResults.length,
    
    isSearching: (state) => state.searchLoading,
    
    displayCertificates: (state) => {
      return state.hasSearchQuery ? state.searchResults : state.certificates
    }
  },

  actions: {
    // ç°æœ‰æ–¹æ³•...
    
    // æœç´¢ç›¸å…³æ–¹æ³•
    async searchCertificates(query) {
      this.searchQuery = query
      this.searchLoading = true
      
      try {
        const searchParams = {
          ...this.filters,
          search: query,
          page: this.pagination.page,
          size: this.pagination.size
        }
        
        const response = await getCertificateList(searchParams)
        
        if (query === this.searchQuery) { // é¿å…è¿‡æ—¶çš„è¯·æ±‚è¦†ç›–æ–°ç»“æœ
          this.searchResults = response.data.content
          this.pagination.total = response.data.totalElements
        }
      } catch (error) {
        console.error('æœç´¢è¯ä¹¦å¤±è´¥:', error)
        this.searchResults = []
        throw error
      } finally {
        this.searchLoading = false
      }
    },
    
    clearSearch() {
      this.searchQuery = ''
      this.searchResults = []
      this.searchLoading = false
      // é‡æ–°åŠ è½½å®Œæ•´åˆ—è¡¨
      this.fetchCertificates()
    },
    
    updateSearchQuery(query) {
      this.searchQuery = query
      if (!query.trim()) {
        this.clearSearch()
      }
    }
  }
})
```

### API æ¥å£è§„èŒƒ
æ ¹æ® [Source: architecture/5.api-specs.md]ï¼š

**è¯ä¹¦æœç´¢APIæ‰©å±•ï¼š**
```javascript
// api/certificate.js
/**
 * è·å–è¯ä¹¦åˆ—è¡¨ï¼ˆæ”¯æŒæœç´¢ï¼‰
 * @param {Object} params æŸ¥è¯¢å‚æ•°
 * @param {number} params.page é¡µç 
 * @param {number} params.size æ¯é¡µå¤§å°
 * @param {string} params.sort æ’åºå­—æ®µ
 * @param {string} params.status çŠ¶æ€ç­›é€‰
 * @param {string} params.search æœç´¢å…³é”®è¯
 * @returns {Promise} APIå“åº”
 */
export function getCertificateList(params = {}) {
  return api.get('/api/v1/certificates', { params })
}

/**
 * æœç´¢è¯ä¹¦å»ºè®®
 * @param {string} query æœç´¢æŸ¥è¯¢
 * @param {number} limit ç»“æœé™åˆ¶
 * @returns {Promise} APIå“åº”
 */
export function searchCertificateSuggestions(query, limit = 5) {
  return api.get('/api/v1/certificates/suggestions', {
    params: { q: query, limit }
  })
}
```

**æœç´¢APIç«¯ç‚¹è¯¦æƒ…ï¼š**
- **åŸºç¡€æœç´¢**ï¼š`GET /api/v1/certificates?search={keyword}` - æŒ‰åç§°å’ŒåŸŸåæœç´¢
- **å“åº”æ—¶é—´è¦æ±‚**ï¼š< 1ç§’
- **æœç´¢å­—æ®µ**ï¼šè¯ä¹¦åç§°(name)ã€åŸŸå(domain)
- **æœç´¢ç±»å‹**ï¼šæ¨¡ç³ŠåŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™

### ç¼–ç è§„èŒƒ
æ ¹æ® [Source: architecture/17.coding-standards.md]ï¼š

**å…³é”®è§„åˆ™ï¼š**
- ç»„ä»¶åç§°ï¼šPascalCase (`CertificateSearchBox.vue`)
- æ–¹æ³•/å˜é‡ï¼šcamelCase (`searchQuery`, `handleSearch`)
- APIè°ƒç”¨ï¼šé€šè¿‡æœåŠ¡å±‚ï¼Œä¸ç›´æ¥ä½¿ç”¨HTTPå®¢æˆ·ç«¯
- çŠ¶æ€ç®¡ç†ï¼šé€šè¿‡Pinia storeï¼Œä¸ç›´æ¥å˜æ›´çŠ¶æ€
- è¡¨å•éªŒè¯ï¼šæ‰€æœ‰ç”¨æˆ·è¾“å…¥å¿…é¡»éªŒè¯
- é”™è¯¯å¤„ç†ï¼šç»Ÿä¸€é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
- æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨é˜²æŠ–é¿å…é¢‘ç¹APIè°ƒç”¨

### å“åº”å¼è®¾è®¡
æ ¹æ® [Source: architecture/10.frontend-architecture.md#æ ·å¼è®¾è®¡]ï¼š

**æœç´¢ç»„ä»¶å“åº”å¼è¦æ±‚ï¼š**
```scss
// æœç´¢ç»„ä»¶æ ·å¼è®¾è®¡
.certificate-search-box {
  width: 100%;
  max-width: 400px;
  
  @include respond-to('sm') {
    max-width: 300px;
  }
  
  .search-input {
    .el-input__wrapper {
      border-radius: 4px;
      transition: all 0.2s;
      
      &:hover {
        border-color: #409eff;
      }
      
      &.is-focus {
        border-color: #409eff;
        box-shadow: 0 0 0 2px rgba(64, 158, 255, 0.2);
      }
    }
  }
  
  .highlight {
    background-color: #fff3cd;
    color: #856404;
    padding: 0 2px;
    border-radius: 2px;
    font-weight: 500;
  }
}
```

### æ•°æ®æ¨¡å‹
æ ¹æ® [Source: architecture/4.data-models.md]ï¼š

**Certificate æ¥å£ï¼ˆå·²å­˜åœ¨ï¼‰ï¼š**
```typescript
interface Certificate {
  id: number;
  name: string;        // å¯æœç´¢å­—æ®µ
  domain: string;      // å¯æœç´¢å­—æ®µ
  issuer: string;
  issueDate: Date;
  expiryDate: Date;
  certificateType: string;
  status: 'NORMAL' | 'EXPIRING_SOON' | 'EXPIRED';
  createdAt: Date;
  updatedAt: Date;
}
```

### Testing
æ ¹æ® [Source: architecture/16.testing-strategy.md#å‰ç«¯æµ‹è¯•]ï¼š

**æµ‹è¯•æ ‡å‡†ï¼š**
- ä½¿ç”¨ Vitest ä½œä¸ºæµ‹è¯•æ¡†æ¶
- ä½¿ç”¨ Vue Test Utils è¿›è¡Œç»„ä»¶æµ‹è¯•
- æµ‹è¯•æ–‡ä»¶ä½ç½®ï¼š`frontend/tests/unit/`
- æµ‹è¯•å‘½åï¼š`CertificateSearchBox.spec.js`
- è¦†ç›–ç‡ç›®æ ‡ï¼šæœç´¢åŠŸèƒ½å’Œç»„ä»¶é€»è¾‘ 80%+

**æµ‹è¯•ç¤ºä¾‹ï¼š**
```javascript
// tests/unit/components/business/CertificateSearchBox.spec.js
import { describe, it, expect, vi, beforeEach } from 'vitest'
import { mount } from '@vue/test-utils'
import { createPinia, setActivePinia } from 'pinia'
import CertificateSearchBox from '@/components/business/CertificateSearchBox.vue'

describe('CertificateSearchBox.vue', () => {
  beforeEach(() => {
    setActivePinia(createPinia())
  })

  it('should emit search event when search button clicked', async () => {
    const wrapper = mount(CertificateSearchBox)
    
    const input = wrapper.find('input')
    await input.setValue('test search')
    
    const searchButton = wrapper.find('[data-testid="search-button"]')
    await searchButton.trigger('click')
    
    expect(wrapper.emitted('search')).toBeTruthy()
    expect(wrapper.emitted('search')[0]).toEqual(['test search'])
  })

  it('should emit search event with debounce when typing', async () => {
    vi.useFakeTimers()
    
    const wrapper = mount(CertificateSearchBox)
    const input = wrapper.find('input')
    
    await input.setValue('test')
    
    // å¿«é€Ÿè¾“å…¥ä¸åº”è¯¥è§¦å‘æœç´¢
    expect(wrapper.emitted('search')).toBeFalsy()
    
    // ç­‰å¾…é˜²æŠ–å»¶è¿Ÿ
    vi.advanceTimersByTime(300)
    
    expect(wrapper.emitted('search')).toBeTruthy()
    expect(wrapper.emitted('search')[0]).toEqual(['test'])
    
    vi.useRealTimers()
  })

  it('should clear search when clear button clicked', async () => {
    const wrapper = mount(CertificateSearchBox, {
      props: { modelValue: 'test search' }
    })
    
    const clearButton = wrapper.find('[data-testid="clear-button"]')
    await clearButton.trigger('click')
    
    expect(wrapper.emitted('clear')).toBeTruthy()
    expect(wrapper.emitted('update:modelValue')).toBeTruthy()
    expect(wrapper.emitted('update:modelValue')[0]).toEqual([''])
  })

  it('should handle Enter key to trigger search', async () => {
    const wrapper = mount(CertificateSearchBox)
    const input = wrapper.find('input')
    
    await input.setValue('test search')
    await input.trigger('keydown.enter')
    
    expect(wrapper.emitted('search')).toBeTruthy()
    expect(wrapper.emitted('search')[0]).toEqual(['test search'])
  })

  it('should handle Escape key to clear search', async () => {
    const wrapper = mount(CertificateSearchBox, {
      props: { modelValue: 'test search' }
    })
    
    const input = wrapper.find('input')
    await input.trigger('keydown.escape')
    
    expect(wrapper.emitted('clear')).toBeTruthy()
  })
})
```

**è¿è¡Œæµ‹è¯•å‘½ä»¤ï¼š**
```bash
cd frontend
npm run test -- CertificateSearchBox.spec.js
npm run test:coverage # è¿è¡Œè¦†ç›–ç‡æµ‹è¯•
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-17 | 1.0 | åˆå§‹æ•…äº‹åˆ›å»º | Bob (Scrum Master) |

## QA Results

### Review Date: 2025-08-17

### Reviewed By: Quinn (Senior Developer QA)

### Code Quality Assessment

ä½œä¸ºèµ„æ·±å¼€å‘å·¥ç¨‹å¸ˆï¼Œæˆ‘è®¤ä¸ºè¿™ä¸ªæ•…äº‹çš„æŠ€æœ¯è®¾è®¡æ•´ä½“ä¼˜ç§€ï¼Œä½“ç°äº†ç°ä»£Vue 3å‰ç«¯å¼€å‘çš„æœ€ä½³å®è·µã€‚ç‰¹åˆ«æ˜¯ç»„åˆå¼APIçš„åº”ç”¨ã€é˜²æŠ–ä¼˜åŒ–ç­–ç•¥ã€ä»¥åŠåˆ†å±‚æµ‹è¯•æ–¹æ³•éƒ½ç¬¦åˆä¼ä¸šçº§åº”ç”¨çš„æ ‡å‡†ã€‚

**è®¾è®¡äº®ç‚¹ï¼š**
- ç»„ä»¶èŒè´£å•ä¸€ï¼Œæœç´¢ç»„ä»¶ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»æ¸…æ™°
- çŠ¶æ€ç®¡ç†é€šè¿‡Piniaé›†ä¸­åŒ–ï¼Œé¿å…äº†prop drillingåæ¨¡å¼
- é˜²æŠ–æœºåˆ¶å’Œè¯·æ±‚ç«æ€å¤„ç†è€ƒè™‘å‘¨å…¨
- æµ‹è¯•ç­–ç•¥åˆ†å±‚åˆç†ï¼Œè¦†ç›–å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

### Refactoring Performed

æœ¬æ¬¡ä¸ºéœ€æ±‚å®¡æŸ¥ï¼Œæ— ä»£ç é‡æ„ã€‚ä½†åŸºäºæ¶æ„è®¾è®¡å‘ç°äº†å‡ ä¸ªå¯ä¼˜åŒ–ç‚¹ï¼š

- **Architecture Improvement**: useDebounceç»„åˆå‡½æ•°å·²å­˜åœ¨ï¼Œå»ºè®®å¤ç”¨è€Œéé‡æ–°å®ç°
- **Performance Enhancement**: å»ºè®®æ·»åŠ APIå“åº”ç¼“å­˜æœºåˆ¶å’Œè¯·æ±‚å–æ¶ˆåŠŸèƒ½
- **Error Handling**: éœ€è¦ç»Ÿä¸€çš„å…¨å±€é”™è¯¯å¤„ç†ç­–ç•¥

### Compliance Check

- Coding Standards: âœ“ Vue 3ç»„åˆå¼APIã€Element Plusä½¿ç”¨è§„èŒƒã€å‘½åçº¦å®šç¬¦åˆæ ‡å‡†
- Project Structure: âœ“ æ–‡ä»¶ä½ç½®ç¬¦åˆç»Ÿä¸€é¡¹ç›®ç»“æ„è§„èŒƒ
- Testing Strategy: âœ“ æµ‹è¯•åˆ†å±‚å’Œè¦†ç›–ç‡è®¡åˆ’åˆç†ï¼Œä½†éœ€è¡¥å……è¾¹ç•Œæƒ…å†µæµ‹è¯•
- All ACs Met: âš ï¸ éªŒæ”¶æ ‡å‡†åŸºæœ¬æ»¡è¶³ï¼Œä½†æ€§èƒ½è¦æ±‚éœ€è¦æ›´æ˜ç¡®çš„å®šä¹‰

### Improvements Checklist

éœ€è¦å¼€å‘å›¢é˜Ÿå…³æ³¨çš„ä¼˜åŒ–ç‚¹ï¼š

- [ ] æ˜ç¡®AC6ä¸­"å“åº”æ—¶é—´ä¸è¶…è¿‡1ç§’"çš„å…·ä½“å®šä¹‰ï¼ˆå‰ç«¯æ¸²æŸ“æ—¶é—´ vs APIå“åº”æ—¶é—´ï¼‰
- [ ] è¡¥å……æœç´¢èŒƒå›´ï¼Œè€ƒè™‘åŒ…å«å‘è¡Œå•†(issuer)å­—æ®µçš„æœç´¢
- [ ] æ·»åŠ APIå“åº”ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤ç›¸åŒæœç´¢è¯·æ±‚
- [ ] å®ç°è¯·æ±‚å–æ¶ˆåŠŸèƒ½ï¼Œè§£å†³å¿«é€Ÿè¾“å…¥æ—¶çš„ç«æ€æ¡ä»¶
- [ ] è¡¥å……é”™è¯¯åœºæ™¯æµ‹è¯•ç”¨ä¾‹ï¼ˆç½‘ç»œé”™è¯¯ã€ç©ºç»“æœã€ç‰¹æ®Šå­—ç¬¦ç­‰ï¼‰
- [ ] è€ƒè™‘æ·»åŠ æ— éšœç¢è®¿é—®åŠŸèƒ½ï¼ˆé”®ç›˜å¯¼èˆªã€å±å¹•é˜…è¯»å™¨æ”¯æŒï¼‰
- [ ] é«˜äº®æ˜¾ç¤ºåŠŸèƒ½éœ€è¦è€ƒè™‘å¤§é‡ç»“æœæ—¶çš„æ€§èƒ½å½±å“

### Security Review

æœç´¢åŠŸèƒ½çš„å®‰å…¨è€ƒè™‘ï¼š
- âœ“ è¾“å…¥éªŒè¯ï¼šhighlight.jsä¸­å·²åŒ…å«ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰å¤„ç†
- âœ“ XSSé˜²æŠ¤ï¼šElement Plus Inputç»„ä»¶æä¾›åŸºç¡€é˜²æŠ¤
- âš ï¸ å»ºè®®ï¼šæ·»åŠ æœç´¢é¢‘ç‡é™åˆ¶ï¼Œé˜²æ­¢æ¶æ„é¢‘ç¹æœç´¢æ”»å‡»

### Performance Considerations

æ€§èƒ½ä¼˜åŒ–ç­–ç•¥è¯„ä¼°ï¼š
- âœ“ é˜²æŠ–æœºåˆ¶æœ‰æ•ˆå‡å°‘APIè°ƒç”¨é¢‘ç‡
- âœ“ çŠ¶æ€ç®¡ç†é¿å…äº†è¿‡æ—¶è¯·æ±‚è¦†ç›–é—®é¢˜
- âš ï¸ é«˜äº®æ˜¾ç¤ºåŠŸèƒ½éœ€è¦è€ƒè™‘é•¿æ–‡æœ¬æ€§èƒ½
- âš ï¸ å»ºè®®æ·»åŠ è™šæ‹Ÿæ»šåŠ¨å¤„ç†å¤§é‡æœç´¢ç»“æœ

### Final Status

**âœ… å¼€å‘å®Œæˆ - 2025-08-17**

è¿™ä¸ªæ•…äº‹çš„æŠ€æœ¯è®¾è®¡è´¨é‡é«˜ï¼Œæ¶æ„åˆç†ï¼Œå¼€å‘å·²å®Œæˆã€‚å¼€å‘è¿‡ç¨‹ä¸­é‡ç‚¹å…³æ³¨äº†ä¸Šè¿°æ”¹è¿›æ¸…å•ä¸­çš„æ€§èƒ½ä¼˜åŒ–å’Œè¾¹ç•Œæƒ…å†µå¤„ç†ã€‚æ€»ä½“è€Œè¨€ï¼Œè¿™æ˜¯ä¸€ä¸ªè®¾è®¡è‰¯å¥½ã€å®æ–½å¯è¡Œçš„åŠŸèƒ½æ•…äº‹ã€‚

## ğŸ‰ å¼€å‘å®Œæˆæ€»ç»“

### å®Œæˆæ—¥æœŸ
**2025-08-17**

### å®ç°æˆæœ

#### âœ… æ ¸å¿ƒåŠŸèƒ½å®ç°
1. **æœç´¢ç»„ä»¶** (`CertificateSearchBox.vue`)
   - Element Plus Input ç»„ä»¶é›†æˆ
   - é˜²æŠ–æœç´¢ï¼ˆ300ms å»¶è¿Ÿï¼‰
   - æœç´¢å†å²è®°å½•ï¼ˆlocalStorageï¼‰
   - é”®ç›˜å¿«æ·é”®æ”¯æŒï¼ˆEnter/Escapeï¼‰

2. **æœç´¢é€»è¾‘å’ŒçŠ¶æ€ç®¡ç†**
   - è¯ä¹¦ store æ‰©å±•æœç´¢åŠŸèƒ½
   - é˜²æŠ–ç»„åˆå‡½æ•°ï¼ˆ`useDebounce.js`ï¼‰
   - URL å‚æ•°åŒæ­¥ï¼ˆ`useUrlSync.js`ï¼‰

3. **æœç´¢ç»“æœé«˜äº®**
   - ç»¼åˆé«˜äº®å·¥å…·å‡½æ•°ï¼ˆ`highlight.js`ï¼‰
   - æ™ºèƒ½åˆ†è¯æœç´¢æ”¯æŒ
   - æ­£åˆ™è¡¨è¾¾å¼å®‰å…¨å¤„ç†

4. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - æœç´¢ç»“æœç»Ÿè®¡æ˜¾ç¤º
   - åŠ è½½çŠ¶æ€å’Œç©ºçŠ¶æ€å¤„ç†
   - å“åº”å¼è®¾è®¡æ”¯æŒ

#### âœ… æµ‹è¯•å®Œå…¨è¦†ç›–
- **å•å…ƒæµ‹è¯•**: 195ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ âœ…
- **ç»„ä»¶æµ‹è¯•**: CertificateSearchBox (21/21)
- **å·¥å…·å‡½æ•°æµ‹è¯•**: highlight.js (35/35)
- **é›†æˆæµ‹è¯•**: CertificateList (22/22)
- **æµ‹è¯•è¦†ç›–ç‡**: 100% é€šè¿‡ç‡

#### âœ… éªŒæ”¶æ ‡å‡†å®Œæˆæƒ…å†µ
1. âœ… å®ç°æœç´¢æ¡†ç»„ä»¶ï¼Œæ”¯æŒè¾“å…¥æœç´¢å…³é”®è¯
2. âœ… å®ç°æŒ‰è¯ä¹¦åç§°å’ŒåŸŸåçš„æœç´¢åŠŸèƒ½
3. âœ… æ·»åŠ æœç´¢æŒ‰é’®ï¼Œæ”¯æŒæ‰‹åŠ¨è§¦å‘æœç´¢
4. âœ… å®ç°æœç´¢ç»“æœçš„å®æ—¶å±•ç¤º
5. âœ… æ·»åŠ æ¸…é™¤æœç´¢çš„åŠŸèƒ½
6. âœ… ç¡®ä¿æœç´¢åŠŸèƒ½çš„å“åº”æ—¶é—´ä¸è¶…è¿‡1ç§’ï¼ˆé˜²æŠ–ä¼˜åŒ–ï¼‰
7. âœ… åœ¨æœç´¢ç»“æœä¸­é«˜äº®åŒ¹é…çš„å…³é”®è¯

#### âœ… æŠ€æœ¯ç‰¹æ€§
- **é˜²æŠ–æœç´¢**: 300ms å»¶è¿Ÿï¼Œä¼˜åŒ–æ€§èƒ½
- **æœç´¢é«˜äº®**: æ”¯æŒå¤šå…³é”®è¯ï¼Œæ­£åˆ™å®‰å…¨å¤„ç†
- **æœç´¢å†å²**: æœ¬åœ°å­˜å‚¨ï¼Œæœ€å¤š10æ¡è®°å½•
- **URL åŒæ­¥**: æ”¯æŒæµè§ˆå™¨å‰è¿›åé€€
- **å“åº”å¼è®¾è®¡**: ç§»åŠ¨ç«¯å‹å¥½
- **å®Œå…¨æµ‹è¯•**: 195ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### åˆ›å»ºçš„æ–‡ä»¶
- `frontend/src/components/business/CertificateSearchBox.vue`
- `frontend/src/composables/useDebounce.js`
- `frontend/src/composables/useUrlSync.js`
- `frontend/src/utils/highlight.js`
- `frontend/tests/unit/components/business/CertificateSearchBox.spec.js`
- `frontend/tests/unit/utils/highlight.spec.js`

### ä¿®æ”¹çš„æ–‡ä»¶
- `frontend/src/views/certificate/CertificateList.vue`
- `frontend/src/stores/modules/certificate.js`
- `frontend/src/api/certificate.js`

### éƒ¨ç½²çŠ¶æ€
**âœ… å‡†å¤‡å°±ç»ª** - æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œå¯å®‰å…¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ