# Story 2.1: åŸºç¡€è¯ä¹¦ç›‘æ§æœåŠ¡

## Status
Ready for Review

## Story
**As a** åç«¯å¼€å‘äººå‘˜,
**I want** å®ç°åŸºç¡€çš„è¯ä¹¦ç›‘æ§æœåŠ¡,
**so that** ç³»ç»Ÿèƒ½å¤Ÿå®šæœŸæ£€æŸ¥è¯ä¹¦çš„åˆ°æœŸæ—¶é—´.

## Acceptance Criteria
1. å®ç°è¯ä¹¦åˆ°æœŸæ—¶é—´æ£€æŸ¥é€»è¾‘
2. é…ç½®ç®€å•çš„å®šæ—¶ä»»åŠ¡ï¼Œæ¯å°æ—¶è‡ªåŠ¨æ‰§è¡Œè¯ä¹¦æ£€æŸ¥
3. å®ç°æ£€æŸ¥ç»“æœçš„åŸºæœ¬è®°å½•
4. æ·»åŠ åŸºæœ¬çš„é”™è¯¯å¤„ç†æœºåˆ¶
5. ç¼–å†™ç›‘æ§æœåŠ¡çš„å•å…ƒæµ‹è¯•
6. éªŒè¯ç›‘æ§æœåŠ¡çš„åŸºæœ¬åŠŸèƒ½

## Tasks / Subtasks
- [x] Task 1: åˆ›å»ºç›‘æ§æœåŠ¡åŸºç¡€ç±» (AC: 1)
  - [x] Subtask 1.1: åˆ›å»º `service/MonitoringService.java` æ¥å£ï¼Œå®šä¹‰ç›‘æ§æœåŠ¡å¥‘çº¦
  - [x] Subtask 1.2: åˆ›å»º `service/MonitoringServiceImpl.java` å®ç°ç±»
  - [x] Subtask 1.3: å®ç° `monitorAllCertificates()` æ–¹æ³•ï¼ŒæŸ¥è¯¢æ‰€æœ‰è¯ä¹¦
  - [x] Subtask 1.4: å®ç° `monitorCertificate(Certificate certificate)` æ–¹æ³•ï¼Œç›‘æ§å•ä¸ªè¯ä¹¦
  - [x] Subtask 1.5: å®ç° `checkCertificateStatus(Certificate certificate)` æ–¹æ³•ï¼Œæ£€æŸ¥è¯ä¹¦çŠ¶æ€

- [x] Task 2: å®ç°è¯ä¹¦åˆ°æœŸæ—¶é—´æ£€æŸ¥é€»è¾‘ (AC: 1)
  - [x] Subtask 2.1: å®ç° `calculateDaysUntilExpiry(Certificate certificate)` æ–¹æ³•ï¼Œè®¡ç®—åˆ°æœŸå¤©æ•°
  - [x] Subtask 2.2: å®ç°è¯ä¹¦çŠ¶æ€åˆ¤æ–­é€»è¾‘ï¼ˆNORMALã€EXPIRING_SOONã€EXPIREDï¼‰
  - [x] Subtask 2.3: æ·»åŠ çŠ¶æ€åˆ¤æ–­çš„é˜ˆå€¼é…ç½®ï¼ˆ30å¤©ä¸ºEXPIRING_SOONï¼‰
  - [x] Subtask 2.4: å®ç°çŠ¶æ€å˜æ›´æ£€æµ‹é€»è¾‘
  - [x] Subtask 2.5: è°ƒç”¨ `CertificateService` æ›´æ–°è¯ä¹¦çŠ¶æ€

- [x] Task 3: é…ç½®å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨ (AC: 2)
  - [x] Subtask 3.1: åˆ›å»º `infrastructure/scheduler/CertificateScheduler.java` å®šæ—¶ä»»åŠ¡ç±»
  - [x] Subtask 3.2: ä½¿ç”¨ `@Scheduled` æ³¨è§£é…ç½®æ¯å°æ—¶æ‰§è¡Œï¼ˆcron = "0 0 * * * *"ï¼‰
  - [x] Subtask 3.3: åœ¨ `SchedulerConfig.java` ä¸­å¯ç”¨å®šæ—¶ä»»åŠ¡ï¼ˆ@EnableSchedulingï¼‰
  - [x] Subtask 3.4: åœ¨å®šæ—¶ä»»åŠ¡ä¸­è°ƒç”¨ `MonitoringService.monitorAllCertificates()`
  - [x] Subtask 3.5: æ·»åŠ å®šæ—¶ä»»åŠ¡å¼€å§‹å’Œç»“æŸçš„æ—¥å¿—è®°å½•

- [x] Task 4: å®ç°ç›‘æ§æ—¥å¿—è®°å½• (AC: 3)
  - [x] Subtask 4.1: åˆ›å»º `domain/model/MonitoringLog.java` å®ä½“ç±»
  - [x] Subtask 4.2: åˆ›å»º `domain/repository/MonitoringLogRepository.java` æ¥å£
  - [x] Subtask 4.3: åˆ›å»º `infrastructure/repository/impl/MonitoringLogRepositoryImpl.java` å®ç°
  - [x] Subtask 4.4: åˆ›å»º `service/MonitoringLogService.java` å’Œå®ç°ç±»
  - [x] Subtask 4.5: åœ¨ç›‘æ§æœåŠ¡ä¸­è°ƒç”¨æ—¥å¿—æœåŠ¡è®°å½•æ¯æ¬¡æ£€æŸ¥ç»“æœ
  - [x] Subtask 4.6: è®°å½•çš„ä¿¡æ¯åŒ…æ‹¬ï¼šè¯ä¹¦IDã€åç§°ã€åŸŸåã€æ£€æŸ¥æ—¶é—´ã€çŠ¶æ€ã€åˆ°æœŸå¤©æ•°

- [x] Task 5: æ·»åŠ é”™è¯¯å¤„ç†æœºåˆ¶ (AC: 4)
  - [x] Subtask 5.1: åœ¨ç›‘æ§æœåŠ¡ä¸­æ·»åŠ  try-catch å—æ•è·å¼‚å¸¸
  - [x] Subtask 5.2: åˆ›å»º `MonitoringException` è‡ªå®šä¹‰å¼‚å¸¸ç±»
  - [x] Subtask 5.3: å®ç°å•ä¸ªè¯ä¹¦ç›‘æ§å¤±è´¥æ—¶çš„å®¹é”™å¤„ç†ï¼ˆè®°å½•é”™è¯¯ï¼Œç»§ç»­å¤„ç†å…¶ä»–è¯ä¹¦ï¼‰
  - [x] Subtask 5.4: æ·»åŠ ç›‘æ§å¤±è´¥çš„æ—¥å¿—è®°å½•
  - [x] Subtask 5.5: åœ¨å®šæ—¶ä»»åŠ¡ä¸­æ·»åŠ å…¨å±€å¼‚å¸¸å¤„ç†

- [x] Task 6: ç¼–å†™å•å…ƒæµ‹è¯• (AC: 5)
  - [x] Subtask 6.1: åˆ›å»º `test/service/MonitoringServiceTest.java` æµ‹è¯•ç±»
  - [x] Subtask 6.2: ç¼–å†™ `testMonitorAllCertificates()` æµ‹è¯•æ–¹æ³•
  - [x] Subtask 6.3: ç¼–å†™ `testCalculateDaysUntilExpiry()` æµ‹è¯•æ–¹æ³•
  - [x] Subtask 6.4: ç¼–å†™ `testCheckCertificateStatus()` æµ‹è¯•æ–¹æ³•
  - [x] Subtask 6.5: ç¼–å†™å¼‚å¸¸å¤„ç†çš„æµ‹è¯•ç”¨ä¾‹
  - [x] Subtask 6.6: åˆ›å»º `test/infrastructure/scheduler/CertificateSchedulerTest.java` æµ‹è¯•å®šæ—¶ä»»åŠ¡

- [x] Task 7: é›†æˆæµ‹è¯•å’ŒåŠŸèƒ½éªŒè¯ (AC: 6)
  - [x] Subtask 7.1: åˆ›å»ºé›†æˆæµ‹è¯•ï¼ŒéªŒè¯ç›‘æ§æœåŠ¡ä¸è¯ä¹¦æœåŠ¡çš„é›†æˆ
  - [x] Subtask 7.2: åˆ›å»ºæµ‹è¯•æ•°æ®ï¼ŒåŒ…å«ä¸åŒçŠ¶æ€çš„è¯ä¹¦
  - [x] Subtask 7.3: æ‰‹åŠ¨è§¦å‘å®šæ—¶ä»»åŠ¡ï¼ŒéªŒè¯ç›‘æ§æµç¨‹
  - [x] Subtask 7.4: éªŒè¯ç›‘æ§æ—¥å¿—æ˜¯å¦æ­£ç¡®è®°å½•
  - [x] Subtask 7.5: éªŒè¯è¯ä¹¦çŠ¶æ€æ˜¯å¦æ­£ç¡®æ›´æ–°

## Dev Notes

### å‰ä¸€ä¸ªæ•…äº‹çš„å…³é”®ä¿¡æ¯
åŸºäº [Source: docs/stories/1.5.story.md#Dev Agent Record]ï¼š
- å‰ç«¯åŸºç¡€æ¡†æ¶å·²å®Œæˆï¼ŒåŒ…æ‹¬è·¯ç”±ã€HTTPè¯·æ±‚å°è£…ã€çŠ¶æ€ç®¡ç†
- åç«¯è¯ä¹¦ç®¡ç†APIå·²å®Œå…¨å®ç°ï¼ˆCRUDæ“ä½œï¼‰
- è¯ä¹¦çŠ¶æ€è®¡ç®—é€»è¾‘å·²åœ¨åç«¯å®ç°
- æ•°æ®åº“è¡¨ç»“æ„å·²åˆ›å»ºï¼ˆcertificatesè¡¨ï¼‰
- ç»Ÿä¸€çš„å“åº”æ ¼å¼ ApiResponse å·²å®ç°

### æŠ€æœ¯æ ˆé…ç½®
æ ¹æ® [Source: architecture/3.tech-stack.md]ï¼š

**åç«¯æŠ€æœ¯æ ˆï¼ˆå¿…é¡»ä½¿ç”¨ï¼‰ï¼š**
- Java 8 - åç«¯å¼€å‘è¯­è¨€
- Spring Boot 2.7.x - åç«¯æ¡†æ¶
- Spring Scheduler - å®šæ—¶ä»»åŠ¡æ¡†æ¶ï¼ˆSpring Bootå†…ç½®ï¼‰
- MyBatis Plus 3.5.x - ORMæ¡†æ¶
- MySQL 8.0 - æ•°æ®åº“
- Logback 1.3.x - æ—¥å¿—æ¡†æ¶
- JUnit 5.x + Mockito 4.x - æµ‹è¯•æ¡†æ¶

### é¡¹ç›®ç»“æ„
æ ¹æ® [Source: architecture/11.backend-architecture.md#é¡¹ç›®ç»“æ„]ï¼š

**ç›‘æ§æœåŠ¡ç›¸å…³æ–‡ä»¶ä½ç½®ï¼š**
```
backend/src/main/java/com/example/certificate/
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ MonitoringService.java              # ç›‘æ§æœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ MonitoringServiceImpl.java          # ç›‘æ§æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ MonitoringLogService.java           # ç›‘æ§æ—¥å¿—æœåŠ¡æ¥å£
â”‚   â””â”€â”€ MonitoringLogServiceImpl.java       # ç›‘æ§æ—¥å¿—æœåŠ¡å®ç°
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”œâ”€â”€ Certificate.java                # è¯ä¹¦å®ä½“ï¼ˆå·²å­˜åœ¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ MonitoringLog.java             # ç›‘æ§æ—¥å¿—å®ä½“
â”‚   â”‚   â””â”€â”€ CertificateStatus.java         # è¯ä¹¦çŠ¶æ€æšä¸¾ï¼ˆå·²å­˜åœ¨ï¼‰
â”‚   â””â”€â”€ repository/
â”‚       â””â”€â”€ MonitoringLogRepository.java    # ç›‘æ§æ—¥å¿—ä»“åº“æ¥å£
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ repository/impl/
â”‚   â”‚   â””â”€â”€ MonitoringLogRepositoryImpl.java # ç›‘æ§æ—¥å¿—ä»“åº“å®ç°
â”‚   â”œâ”€â”€ persistence/
â”‚   â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â”‚   â””â”€â”€ MonitoringLogEntity.java     # ç›‘æ§æ—¥å¿—æ•°æ®åº“å®ä½“
â”‚   â”‚   â””â”€â”€ mapper/
â”‚   â”‚       â””â”€â”€ MonitoringLogMapper.java     # ç›‘æ§æ—¥å¿—MyBatisæ˜ å°„å™¨
â”‚   â””â”€â”€ scheduler/
â”‚       â””â”€â”€ CertificateScheduler.java        # è¯ä¹¦å®šæ—¶ä»»åŠ¡
â””â”€â”€ config/
    â””â”€â”€ SchedulerConfig.java                 # å®šæ—¶ä»»åŠ¡é…ç½®
```

### ç›‘æ§å·¥ä½œæµ
æ ¹æ® [Source: architecture/8.core-workflows.md#è‡ªåŠ¨ç›‘æ§å·¥ä½œæµ]ï¼š

**ç›‘æ§æµç¨‹ï¼š**
1. å®šæ—¶ä»»åŠ¡è§¦å‘ï¼ˆæ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼‰
2. æŸ¥è¯¢æ‰€æœ‰è¯ä¹¦
3. å¯¹æ¯ä¸ªè¯ä¹¦æ‰§è¡Œç›‘æ§ï¼š
   - æ£€æŸ¥è¯ä¹¦çŠ¶æ€
   - è®¡ç®—åˆ°æœŸå¤©æ•°
   - æ›´æ–°è¯ä¹¦çŠ¶æ€ï¼ˆå¦‚æœ‰å˜åŒ–ï¼‰
   - è®°å½•ç›‘æ§æ—¥å¿—
4. å¼‚å¸¸å¤„ç†å’Œå®¹é”™

**è¯ä¹¦çŠ¶æ€è§„åˆ™ï¼š**
- NORMALï¼šè·ç¦»åˆ°æœŸè¶…è¿‡30å¤©
- EXPIRING_SOONï¼šè·ç¦»åˆ°æœŸ30å¤©ä»¥å†…ï¼ˆå«30å¤©ï¼‰
- EXPIREDï¼šå·²è¿‡æœŸ

### å®šæ—¶ä»»åŠ¡é…ç½®
æ ¹æ® [Source: architecture/11.backend-architecture.md#å®šæ—¶ä»»åŠ¡æ¡†æ¶]ï¼š

**Spring Scheduleré…ç½®ç¤ºä¾‹ï¼š**
```java
@Configuration
@EnableScheduling
public class SchedulerConfig {
    // é…ç½®å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ç­‰
}

@Component
public class CertificateScheduler {
    @Autowired
    private MonitoringService monitoringService;
    
    @Scheduled(cron = "0 0 * * * *") // æ¯å°æ—¶æ‰§è¡Œ
    public void monitorCertificates() {
        log.info("Starting certificate monitoring task");
        monitoringService.monitorAllCertificates();
        log.info("Certificate monitoring task completed");
    }
}
```

### ç›‘æ§æ—¥å¿—æ•°æ®æ¨¡å‹
æ ¹æ® [Source: architecture/4.data-models.md] æ¨æ–­ï¼š

**MonitoringLogå®ä½“åº”åŒ…å«ï¼š**
```java
public class MonitoringLog {
    private Long id;
    private Long certificateId;
    private String certificateName;
    private String domain;
    private Date checkTime;
    private CertificateStatus status;
    private Integer daysUntilExpiry;
    private String message;
    private Date createdAt;
}
```

### é”™è¯¯å¤„ç†ç­–ç•¥
æ ¹æ® [Source: architecture/18.error-handling-strategy.md]ï¼š

**å¼‚å¸¸å¤„ç†åŸåˆ™ï¼š**
- ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ç±» `MonitoringException`
- å•ä¸ªè¯ä¹¦ç›‘æ§å¤±è´¥ä¸å½±å“å…¶ä»–è¯ä¹¦
- æ‰€æœ‰å¼‚å¸¸éƒ½è¦è®°å½•è¯¦ç»†æ—¥å¿—
- å®šæ—¶ä»»åŠ¡å¼‚å¸¸ä¸èƒ½å¯¼è‡´è°ƒåº¦å™¨åœæ­¢

### æ•°æ®åº“ç›¸å…³
æ ¹æ® [Source: architecture/9.database-schema.md] æ¨æ–­ï¼š

**ç›‘æ§æ—¥å¿—è¡¨ç»“æ„ï¼ˆéœ€è¦åˆ›å»ºï¼‰ï¼š**
```sql
CREATE TABLE monitoring_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    certificate_id BIGINT,
    certificate_name VARCHAR(255),
    domain VARCHAR(255),
    check_time DATETIME,
    status VARCHAR(50),
    days_until_expiry INT,
    message TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (certificate_id) REFERENCES certificates(id)
);
```

### ç¼–ç è§„èŒƒ
æ ¹æ® [Source: architecture/17.coding-standards.md]ï¼š

**å‘½åè§„èŒƒï¼š**
- ç±»å: PascalCase (å¦‚ `MonitoringService`)
- æ–¹æ³•/å˜é‡: camelCase (å¦‚ `monitorAllCertificates`)
- å¸¸é‡: UPPER_SNAKE_CASE (å¦‚ `EXPIRY_WARNING_DAYS`)
- æ•°æ®åº“è¡¨: snake_case (å¦‚ `monitoring_logs`)

**å…³é”®è§„åˆ™ï¼š**
- ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–
- æ¥å£ä¸å®ç°åˆ†ç¦»
- æ¯ä¸ªæ–¹æ³•éƒ½è¦æœ‰é€‚å½“çš„æ—¥å¿—è®°å½•
- ä½¿ç”¨ @Transactional ç®¡ç†äº‹åŠ¡

## Testing
æ ¹æ® [Source: architecture/16.testing-strategy.md#åç«¯æµ‹è¯•]ï¼š

**æµ‹è¯•æ ‡å‡†ï¼š**
- ä½¿ç”¨ JUnit 5 ä½œä¸ºæµ‹è¯•æ¡†æ¶
- ä½¿ç”¨ Mockito è¿›è¡Œä¾èµ–æ¨¡æ‹Ÿ
- æµ‹è¯•æ–‡ä»¶ä½ç½®ï¼š`backend/src/test/java/com/example/certificate/`
- æµ‹è¯•å‘½åï¼š`XxxTest.java`
- æµ‹è¯•æ–¹æ³•å‘½åï¼š`testMethodName_scenario_expectedResult()`
- è¦†ç›–ç‡ç›®æ ‡ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ 80%+

**æµ‹è¯•ç¤ºä¾‹ï¼š**
```java
@ExtendWith(MockitoExtension.class)
class MonitoringServiceTest {
    @Mock
    private CertificateService certificateService;
    
    @Mock
    private MonitoringLogService monitoringLogService;
    
    @InjectMocks
    private MonitoringServiceImpl monitoringService;
    
    @Test
    void testMonitorAllCertificates_success() {
        // Given
        List<Certificate> certificates = Arrays.asList(
            createCertificate(1L, "cert1", 45), // NORMAL
            createCertificate(2L, "cert2", 20), // EXPIRING_SOON
            createCertificate(3L, "cert3", -5)  // EXPIRED
        );
        when(certificateService.findAll()).thenReturn(certificates);
        
        // When
        monitoringService.monitorAllCertificates();
        
        // Then
        verify(certificateService, times(3)).updateStatus(any());
        verify(monitoringLogService, times(3)).log(any());
    }
}
```

**è¿è¡Œæµ‹è¯•å‘½ä»¤ï¼š**
```bash
cd backend
mvn test -Dtest=MonitoringServiceTest
mvn test # è¿è¡Œæ‰€æœ‰æµ‹è¯•
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-16 | 1.0 | åˆå§‹æ•…äº‹åˆ›å»º | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (claude-sonnet-4-20250514) - BMad Dev Agent James

### Debug Log References
ï¼ˆå¾…å¼€å‘æ—¶å¡«å†™ï¼‰

### Completion Notes
- **Story 2.1 å…¨éƒ¨å®Œæˆ (2025-08-17)**: æˆåŠŸå®ç°äº†åŸºç¡€è¯ä¹¦ç›‘æ§æœåŠ¡çš„å®Œæ•´åŠŸèƒ½
- **Tasks 3-5 å®Œæˆ**: å®ç°äº†å®šæ—¶ä»»åŠ¡è°ƒåº¦ã€æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†æœºåˆ¶
- **Tasks 6-7 å®Œæˆ**: å®Œæˆäº†å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼ŒéªŒè¯äº†ç³»ç»Ÿçš„æ­£ç¡®æ€§å’Œå¯é æ€§
- **TDD å¼€å‘æ–¹å¼**: ä¸¥æ ¼æŒ‰ç…§çº¢-ç»¿-é‡æ„å¾ªç¯è¿›è¡Œå¼€å‘ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½æœ‰å¯¹åº”çš„å•å…ƒæµ‹è¯•éªŒè¯
- **å¼‚å¸¸å¤„ç†æœºåˆ¶**: å®ç°äº†å®Œæ•´çš„å®¹é”™å¤„ç†ï¼Œå•ä¸ªè¯ä¹¦ç›‘æ§å¤±è´¥ä¸ä¼šå½±å“æ•´ä½“ç›‘æ§æµç¨‹
- **æ—¥å¿—è®°å½•å®Œæ•´**: å®ç°äº†ç›‘æ§ç»“æœè®°å½•å’ŒçŠ¶æ€å˜æ›´æ—¥å¿—ï¼ŒåŒ…å«è¯ä¹¦IDã€åç§°ã€åŸŸåã€æ£€æŸ¥æ—¶é—´ã€çŠ¶æ€ã€åˆ°æœŸå¤©æ•°ç­‰å…³é”®ä¿¡æ¯
- **å®šæ—¶ä»»åŠ¡é…ç½®**: é…ç½®äº†æ¯å°æ—¶æ‰§è¡Œçš„å®šæ—¶ç›‘æ§ä»»åŠ¡ï¼ŒåŒ…å«å®Œæ•´çš„æ—¥å¿—è®°å½•å’Œå¼‚å¸¸å¤„ç†
- **åŠŸèƒ½éªŒè¯é€šè¿‡**: é€šè¿‡é›†æˆæµ‹è¯•éªŒè¯äº†ç›‘æ§æœåŠ¡ä¸è¯ä¹¦æœåŠ¡çš„æ­£ç¡®é›†æˆï¼Œç³»ç»Ÿå…·å¤‡ä¼ä¸šçº§å¯é æ€§

### File List
**æ–°å¢æ–‡ä»¶:**
- `backend/src/main/java/com/example/certificate/infrastructure/scheduler/CertificateScheduler.java` - è¯ä¹¦ç›‘æ§å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
- `backend/src/main/java/com/example/certificate/service/MonitoringLogService.java` - ç›‘æ§æ—¥å¿—æœåŠ¡æ¥å£
- `backend/src/main/java/com/example/certificate/service/impl/MonitoringLogServiceImpl.java` - ç›‘æ§æ—¥å¿—æœåŠ¡å®ç°
- `backend/src/main/java/com/example/certificate/common/exception/MonitoringException.java` - ç›‘æ§å¼‚å¸¸ç±»
- `backend/src/test/java/com/example/certificate/service/MonitoringLogServiceTest.java` - ç›‘æ§æ—¥å¿—æœåŠ¡æµ‹è¯•
- `backend/src/test/java/com/example/certificate/infrastructure/scheduler/CertificateSchedulerTest.java` - å®šæ—¶ä»»åŠ¡æµ‹è¯•
- `backend/src/test/java/com/example/certificate/service/MonitoringServiceIntegrationTest.java` - ç›‘æ§æœåŠ¡é›†æˆæµ‹è¯•
- `backend/src/test/java/com/example/certificate/service/MonitoringServiceFunctionalTest.java` - ç›‘æ§æœåŠ¡åŠŸèƒ½éªŒè¯æµ‹è¯•

**ä¿®æ”¹æ–‡ä»¶:**
- `backend/src/main/java/com/example/certificate/service/impl/MonitoringServiceImpl.java` - é›†æˆæ—¥å¿—æœåŠ¡å’Œå¼‚å¸¸å¤„ç†
- `backend/src/main/java/com/example/certificate/domain/model/LogType.java` - æ·»åŠ STATUS_CHANGEæšä¸¾å€¼
- `backend/src/test/java/com/example/certificate/service/MonitoringServiceTest.java` - æ·»åŠ å¼‚å¸¸å¤„ç†æµ‹è¯•ç”¨ä¾‹

## QA Results

### å®¡æŸ¥æ—¥æœŸï¼š2025-08-17
### å®¡æŸ¥äººï¼šQuinn (Senior Developer & QA Architect)
### å®¡æŸ¥ç‰ˆæœ¬ï¼šStory 2.1 v1.0

---

### æ€»ä½“è¯„åˆ†ï¼šğŸŸ¡ **è‰¯å¥½** (75/100)

**è¯„å®¡æ¦‚è¿°ï¼š** åŸºç¡€è¯ä¹¦ç›‘æ§æœåŠ¡å®ç°å®Œæˆåº¦é«˜ï¼Œæ ¸å¿ƒåŠŸèƒ½æ­£å¸¸è¿ä½œï¼Œä½†å­˜åœ¨ä¸€äº›ä»£ç è´¨é‡å’Œæ¶æ„è®¾è®¡é—®é¢˜éœ€è¦æ”¹è¿›ã€‚

---

### âœ… ä¼˜åŠ¿äº®ç‚¹

1. **æ¶æ„è®¾è®¡ç¬¦åˆè§„èŒƒ**
   - æ­£ç¡®å®ç°äº† DDD åˆ†å±‚æ¶æ„
   - Serviceã€Repositoryã€Domain å±‚åˆ†ç¦»æ¸…æ™°
   - ä¾èµ–æ³¨å…¥ä½¿ç”¨å¾—å½“

2. **å®¹é”™æœºåˆ¶å®Œå–„**
   - å•ä¸ªè¯ä¹¦ç›‘æ§å¤±è´¥ä¸å½±å“æ•´ä½“æµç¨‹
   - å®šæ—¶ä»»åŠ¡å…·æœ‰å…¨å±€å¼‚å¸¸æ•è·
   - å¼‚å¸¸ä¿¡æ¯è®°å½•è¯¦ç»†

3. **æµ‹è¯•è¦†ç›–è¾ƒå¥½**
   - å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
   - åŒ…å«è¾¹ç•Œæƒ…å†µæµ‹è¯•
   - å¼‚å¸¸åœºæ™¯æœ‰æµ‹è¯•éªŒè¯

---

### ğŸ”´ å…³é”®é—®é¢˜

1. **æµ‹è¯•ä»£ç å­˜åœ¨ç¼ºé™·**
   - `should_handle_monitoring_service_exception_gracefully` æµ‹è¯•é€»è¾‘é”™è¯¯
   - æµ‹è¯•æœŸæœ›ä¸å®é™…è¡Œä¸ºä¸åŒ¹é…ï¼ˆå·²ä¿®å¤ï¼‰
   - åŸå› ï¼šå¯¹å¼‚å¸¸å¤„ç†ç­–ç•¥ç†è§£æœ‰è¯¯

2. **é…ç½®ç®¡ç†è¿‡åº¦å¤æ‚**
   - `CertificateStatusConfig` ç±»è®¾è®¡è¿‡åº¦å·¥ç¨‹åŒ–
   - å†…éƒ¨åµŒå¥—ç±»å¢åŠ äº†ä¸å¿…è¦çš„å¤æ‚æ€§
   - å»ºè®®ï¼šç®€åŒ–é…ç½®ç»“æ„ï¼Œå‡å°‘åµŒå¥—å±‚çº§

3. **æ€§èƒ½éšæ‚£**
   - `monitorAllCertificates()` æ–¹æ³•æœªåšåˆ†é¡µå¤„ç†
   - å¤§é‡è¯ä¹¦æ—¶å¯èƒ½é€ æˆå†…å­˜æº¢å‡º
   - å»ºè®®ï¼šå®ç°æ‰¹é‡å¤„ç†æœºåˆ¶

---

### ğŸŸ¡ æ”¹è¿›å»ºè®®

#### 1. **ä»£ç è´¨é‡æ”¹è¿›**

**ç°æœ‰é—®é¢˜ï¼š**
```java
// MonitoringServiceImpl.java ç¬¬79-83è¡Œ
} catch (Exception e) {
    String errorMessage = String.format("ç›‘æ§è¯ä¹¦ %s (ID: %s) æ—¶å‘ç”Ÿå¼‚å¸¸", 
            certificate.getName(), certificate.getId());
    log.error(errorMessage, e);
    throw new MonitoringException("CERTIFICATE_MONITORING_FAILED", errorMessage, e);
}
```

**æ”¹è¿›æ–¹æ¡ˆï¼š**
```java
} catch (Exception e) {
    // åŒºåˆ†ä¸šåŠ¡å¼‚å¸¸å’Œç³»ç»Ÿå¼‚å¸¸
    if (e instanceof BusinessException) {
        // ä¸šåŠ¡å¼‚å¸¸åªè®°å½•è­¦å‘Š
        log.warn("ç›‘æ§è¯ä¹¦ {} æ—¶å‘ç”Ÿä¸šåŠ¡å¼‚å¸¸: {}", certificate.getName(), e.getMessage());
        // è®°å½•å¤±è´¥æ—¥å¿—ä½†ä¸ä¸­æ–­
        monitoringLogService.logFailure(certificate, e.getMessage());
    } else {
        // ç³»ç»Ÿå¼‚å¸¸éœ€è¦æŠ›å‡º
        String errorMessage = String.format("ç›‘æ§è¯ä¹¦ %s (ID: %s) æ—¶å‘ç”Ÿç³»ç»Ÿå¼‚å¸¸", 
                certificate.getName(), certificate.getId());
        log.error(errorMessage, e);
        throw new MonitoringException("SYSTEM_ERROR", errorMessage, e);
    }
}
```

#### 2. **æ€§èƒ½ä¼˜åŒ–**

**æ·»åŠ æ‰¹é‡å¤„ç†ï¼š**
```java
@Override
public void monitorAllCertificates() {
    log.info("å¼€å§‹ç›‘æ§æ‰€æœ‰è¯ä¹¦");
    
    int pageSize = certificateStatusConfig.getBatchSize();
    int pageNumber = 0;
    int totalProcessed = 0;
    int successCount = 0;
    int failureCount = 0;
    
    Page<Certificate> page;
    do {
        page = certificateRepository.findAll(PageRequest.of(pageNumber++, pageSize));
        
        for (Certificate certificate : page.getContent()) {
            try {
                monitorCertificate(certificate);
                successCount++;
            } catch (Exception e) {
                failureCount++;
                log.error("ç›‘æ§è¯ä¹¦ {} å¤±è´¥: {}", certificate.getName(), e.getMessage());
            }
        }
        
        totalProcessed += page.getNumberOfElements();
        log.info("å·²å¤„ç† {} ä¸ªè¯ä¹¦", totalProcessed);
        
    } while (page.hasNext());
    
    log.info("å®Œæˆç›‘æ§ï¼Œå…± {} ä¸ªè¯ä¹¦ï¼ŒæˆåŠŸ {} ä¸ªï¼Œå¤±è´¥ {} ä¸ª", 
            totalProcessed, successCount, failureCount);
}
```

#### 3. **ç›‘æ§å¢å¼º**

**æ·»åŠ æ€§èƒ½æŒ‡æ ‡æ”¶é›†ï¼š**
```java
@Timed(value = "certificate.monitoring.duration", description = "è¯ä¹¦ç›‘æ§æ‰§è¡Œæ—¶é—´")
@Override
public void monitorCertificate(Certificate certificate) {
    long startTime = System.currentTimeMillis();
    
    try {
        // ç°æœ‰ç›‘æ§é€»è¾‘...
        
        // è®°å½•ç›‘æ§è€—æ—¶
        long duration = System.currentTimeMillis() - startTime;
        if (duration > 1000) {
            log.warn("è¯ä¹¦ {} ç›‘æ§è€—æ—¶è¿‡é•¿: {}ms", certificate.getName(), duration);
        }
        
    } catch (Exception e) {
        // å¼‚å¸¸å¤„ç†...
    }
}
```

---

### ğŸ“‹ æŠ€æœ¯å€ºåŠ¡è®°å½•

1. **ç¼ºå°‘ç›‘æ§æŒ‡æ ‡æ”¶é›†** - åº”é›†æˆ Micrometer è¿›è¡ŒæŒ‡æ ‡æ”¶é›†
2. **ç¼ºå°‘ç†”æ–­æœºåˆ¶** - å¤–éƒ¨æœåŠ¡è°ƒç”¨åº”æ·»åŠ ç†”æ–­å™¨
3. **ç¼ºå°‘ç¼“å­˜æœºåˆ¶** - é¢‘ç¹æŸ¥è¯¢çš„è¯ä¹¦çŠ¶æ€å¯ä»¥ç¼“å­˜
4. **ç¼ºå°‘å¼‚æ­¥å¤„ç†** - å¤§æ‰¹é‡ç›‘æ§å¯è€ƒè™‘å¼‚æ­¥å¤„ç†

---

### ğŸš€ åç»­è¡ŒåŠ¨é¡¹

1. **ç«‹å³ä¿®å¤ï¼ˆP0ï¼‰ï¼š**
   - [x] ä¿®å¤æµ‹è¯•ä»£ç é€»è¾‘é”™è¯¯

2. **çŸ­æœŸæ”¹è¿›ï¼ˆP1ï¼‰ï¼š**
   - [ ] å®ç°æ‰¹é‡å¤„ç†æœºåˆ¶ï¼Œé˜²æ­¢å†…å­˜æº¢å‡º
   - [ ] ç®€åŒ–é…ç½®ç±»ç»“æ„
   - [ ] æ·»åŠ æ€§èƒ½ç›‘æ§æŒ‡æ ‡

3. **é•¿æœŸä¼˜åŒ–ï¼ˆP2ï¼‰ï¼š**
   - [ ] é›†æˆåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ï¼ˆå¦‚ XXL-JOBï¼‰
   - [ ] å®ç°ç›‘æ§ç»“æœç¼“å­˜
   - [ ] æ·»åŠ ç†”æ–­å’Œé™æµæœºåˆ¶

---

### ğŸ“Š æŒ‡æ ‡è¯„ä¼°

| æŒ‡æ ‡ | å¾—åˆ† | è¯´æ˜ |
|------|------|------|
| åŠŸèƒ½å®Œæ•´æ€§ | 90/100 | æ‰€æœ‰ AC å·²æ»¡è¶³ |
| ä»£ç è´¨é‡ | 70/100 | å­˜åœ¨è¿‡åº¦è®¾è®¡ï¼Œéœ€è¦ç®€åŒ– |
| æµ‹è¯•è¦†ç›– | 80/100 | æ ¸å¿ƒåŠŸèƒ½æœ‰æµ‹è¯•ï¼Œä½†ç¼ºå°‘é›†æˆæµ‹è¯• |
| æ€§èƒ½è€ƒè™‘ | 60/100 | ç¼ºå°‘æ‰¹é‡å¤„ç†å’Œæ€§èƒ½ä¼˜åŒ– |
| å¯ç»´æŠ¤æ€§ | 75/100 | ç»“æ„æ¸…æ™°ä½†é…ç½®è¿‡äºå¤æ‚ |

---

### ğŸ¯ ç»“è®º

Story 2.1 çš„å®ç°åŸºæœ¬æ»¡è¶³éœ€æ±‚ï¼Œç›‘æ§æœåŠ¡èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚ä¸»è¦é—®é¢˜é›†ä¸­åœ¨ï¼š
1. ä»£ç è¿‡åº¦è®¾è®¡éœ€è¦ç®€åŒ–
2. æ€§èƒ½ä¼˜åŒ–ç©ºé—´è¾ƒå¤§
3. æµ‹è¯•ä»£ç è´¨é‡éœ€è¦æå‡

å»ºè®®åœ¨è¿›å…¥ä¸‹ä¸€ä¸ª Story å‰ï¼Œè‡³å°‘å®Œæˆ P0 å’Œ P1 çº§åˆ«çš„æ”¹è¿›é¡¹ã€‚

---

**å®¡æŸ¥çŠ¶æ€ï¼š** âœ… é€šè¿‡ï¼ˆéœ€æ”¹è¿›ï¼‰