# é¡¹ç›®å¼€å‘æ•ˆç‡æŒ‡å—ï¼ˆLLMä¸“ç”¨ï¼‰

## ğŸ”´ ç¬¬0æ¡é“å¾‹ï¼šå¿…é¡»ä½¿ç”¨ TDDï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰

### ä¸ºä»€ä¹ˆ TDD æ˜¯å¼ºåˆ¶æ€§çš„ï¼Ÿ
**ä¸ç”¨ TDD = åé¢æ‰€æœ‰é—®é¢˜çš„æ ¹æº**ã€‚æœ¬æ–‡æ¡£ä¸­ 90% çš„é—®é¢˜éƒ½æ˜¯å› ä¸ºæ²¡æœ‰ä½¿ç”¨ TDD å¯¼è‡´çš„ã€‚

### TDD ä¸‰æ­¥å¾ªç¯ï¼ˆä¸¥æ ¼æ‰§è¡Œï¼‰
```bash
1. ğŸ”´ REDï¼šå…ˆå†™å¤±è´¥çš„æµ‹è¯•
   - å®šä¹‰æœŸæœ›è¡Œä¸º
   - æµ‹è¯•å¿…é¡»å¤±è´¥ï¼ˆç¡®ä¿æµ‹è¯•æœ‰æ•ˆï¼‰
   
2. ğŸŸ¢ GREENï¼šå†™æœ€å°‘ä»£ç é€šè¿‡æµ‹è¯•
   - ä¸è¦è¿‡åº¦è®¾è®¡
   - åªå†™åˆšå¥½å¤Ÿé€šè¿‡çš„ä»£ç 
   
3. ğŸ”µ REFACTORï¼šåœ¨æµ‹è¯•ä¿æŠ¤ä¸‹é‡æ„
   - æ”¹è¿›ä»£ç ç»“æ„
   - æµ‹è¯•å§‹ç»ˆä¿æŒç»¿è‰²
```

### TDD æ‰§è¡Œæ¨¡æ¿
```java
// ç¬¬1æ­¥ï¼šå†™æµ‹è¯•ï¼ˆå¿…é¡»å¤±è´¥ï¼‰
@Test
void should_calculate_status_as_expiring_soon_when_30_days_left() {
    // Given
    Certificate cert = createCertificateExpiringIn(30);
    
    // When
    CertificateStatus status = cert.calculateStatus();
    
    // Then
    assertThat(status).isEqualTo(CertificateStatus.EXPIRING_SOON);
}
// è¿è¡Œæµ‹è¯• â†’ ğŸ”´ å¤±è´¥ï¼ˆå› ä¸ºæ–¹æ³•è¿˜ä¸å­˜åœ¨ï¼‰

// ç¬¬2æ­¥ï¼šå†™æœ€å°‘ä»£ç 
public CertificateStatus calculateStatus() {
    return CertificateStatus.EXPIRING_SOON; // æœ€ç®€å•çš„å®ç°
}
// è¿è¡Œæµ‹è¯• â†’ ğŸŸ¢ é€šè¿‡

// ç¬¬3æ­¥ï¼šæ·»åŠ æ›´å¤šæµ‹è¯•é©±åŠ¨çœŸå®å®ç°
@Test
void should_calculate_status_as_normal_when_60_days_left() {
    // æ–°æµ‹è¯•å¼ºåˆ¶ä½ å®ç°çœŸå®é€»è¾‘
}
```

### TDD ç›´æ¥è§£å†³çš„é—®é¢˜
- âœ… **ä¸ä¼šMockç›®æ ‡æ–¹æ³•**ï¼šå› ä¸ºå…ˆå†™æµ‹è¯•ï¼Œè‡ªç„¶çŸ¥é“ä»€ä¹ˆè¯¥Mock
- âœ… **Mocké…ç½®å®Œæ•´**ï¼šæµ‹è¯•é©±åŠ¨ä¼šæš´éœ²æ‰€æœ‰ä¾èµ–
- âœ… **æµ‹è¯•çœŸå®æœ‰æ•ˆ**ï¼šçº¢-ç»¿å¾ªç¯ä¿è¯æµ‹è¯•çœŸçš„åœ¨éªŒè¯åŠŸèƒ½
- âœ… **è®¾è®¡æ›´ç®€æ´**ï¼šæµ‹è¯•é©±åŠ¨å‡ºçš„æ¥å£å¤©ç„¶ç®€å•

## ğŸš¨ æœ€é«˜ä¼˜å…ˆçº§è§„åˆ™ï¼ˆå¿…é¡»éµå®ˆï¼‰

### 1. Mockè§„åˆ™ï¼šæ°¸ä¸Mockç›®æ ‡æ–¹æ³•
```java
// âŒ è‡´å‘½é”™è¯¯
@Mock private TargetService targetService;  // ä¸èƒ½Mockè¦æµ‹è¯•çš„å¯¹è±¡

// âœ… æ­£ç¡®åšæ³•
@Mock private ExternalDependency dependency;  // åªMockå¤–éƒ¨ä¾èµ–
@InjectMocks private TargetService targetService;  // è¢«æµ‹å¯¹è±¡ç”¨çœŸå®å®ä¾‹
```

### 2. æµ‹è¯•æ‰§è¡Œç­–ç•¥ï¼šåˆ†å±‚æ‰§è¡Œ
```bash
# æ‰§è¡Œé¡ºåºï¼ˆèŠ‚çœ90%è°ƒè¯•æ—¶é—´ï¼‰
mvn test -Dtest=SpecificTest  # 1. å…ˆè·‘å•ä¸ªå¤±è´¥çš„æµ‹è¯•
mvn test -Dtest=*ServiceTest   # 2. å†è·‘ç›¸å…³å±‚çš„æµ‹è¯•
mvn test                       # 3. æœ€åæ‰è·‘å…¨é‡æµ‹è¯•
```

### 3. Mocké…ç½®å®Œæ•´æ€§æ£€æŸ¥
```java
// åˆ†æè¢«æµ‹æ–¹æ³•çš„å®Œæ•´è°ƒç”¨é“¾
@InjectMocks ServiceImpl service;
@Mock Repository repository;  
@Mock ConfigClass config;  // å®¹æ˜“é—æ¼ï¼

@Test void test() {
    // å¿…é¡»Mockæ‰€æœ‰ä¾èµ–çš„æ–¹æ³•è°ƒç”¨
    when(config.getValue()).thenReturn(30);  // ä¸è¦é—æ¼é…ç½®ç±»
    when(repository.find()).thenReturn(data);
}
```

## âš¡ å¿«é€Ÿæ•…éšœæ’æŸ¥æ¸…å•

### åç«¯æµ‹è¯•å¤±è´¥æ—¶çš„æ£€æŸ¥é¡ºåº
1. **PotentialStubbingProblem** â†’ Mockå‚æ•°ä¸åŒ¹é… â†’ ä½¿ç”¨`anyInt()`ç­‰åŒ¹é…å™¨
2. **NullPointerException** â†’ ç¼ºå°‘Mocké…ç½® â†’ æ£€æŸ¥æ‰€æœ‰@Mockå­—æ®µçš„æ–¹æ³•è°ƒç”¨
3. **UnfinishedVerificationException** â†’ verify()è¯­æ³•é”™è¯¯ â†’ æ£€æŸ¥verify()è°ƒç”¨å®Œæ•´æ€§
4. **InvalidUseOfMatchersException** â†’ ArgumentMatcherä½ç½®é”™è¯¯ â†’ æ£€æŸ¥argThat()ç”¨æ³•
5. **æ„é€ å‡½æ•°å‚æ•°ä¸åŒ¹é…** â†’ æ–°å¢ä¾èµ–æœªåŒæ­¥ â†’ grepæ‰¾å‡ºæ‰€æœ‰ç›¸å…³æµ‹è¯•æ–‡ä»¶
6. **æ–­è¨€å¤±è´¥** â†’ æ£€æŸ¥æ˜¯å¦Mockäº†ç›®æ ‡æ–¹æ³•æœ¬èº«
7. **è·¯å¾„é”™è¯¯** â†’ å…ˆ`pwd`ç¡®è®¤å½“å‰ç›®å½•

### å‰ç«¯å¼€å‘é—®é¢˜é€ŸæŸ¥
| ç—‡çŠ¶ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|-----|------|---------|
| ç»„ä»¶æŠ¥`$listeners`æœªå®šä¹‰ | Vue 2è¯­æ³•åœ¨Vue 3ä¸­å¤±æ•ˆ | åˆ é™¤ï¼Œå·²è‡ªåŠ¨åˆå¹¶åˆ°$attrs |
| æµ‹è¯•æŠ¥Cannot find module '@/...' | Vitestæœªé…ç½®è·¯å¾„åˆ«å | vitest.config.jsæ·»åŠ resolve.alias |
| ç¯å¢ƒå˜é‡undefined | æœªä½¿ç”¨VITE_å‰ç¼€ | æ”¹ä¸ºVITE_å¼€å¤´çš„å˜é‡å |
| Element Plusç»„ä»¶ä¸ç”Ÿæ•ˆ | æœªæ­£ç¡®å¯¼å…¥ | æ£€æŸ¥main.jsä¸­çš„æ³¨å†Œæ–¹å¼ |
| è·¯ç”±è·³è½¬404 | è·¯ç”±è·¯å¾„ä¸åŒ¹é… | æ£€æŸ¥æ˜¯å¦æœ‰å‰å¯¼æ–œæ  |
| PiniaçŠ¶æ€ä¸¢å¤± | é¡µé¢åˆ·æ–°å¯¼è‡´ | è€ƒè™‘æŒä¹…åŒ–æ’ä»¶ |

### å¸¸è§é™·é˜±é€ŸæŸ¥è¡¨
| ç—‡çŠ¶ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|-----|------|---------|
| æµ‹è¯•éš¾å†™/å¤§é‡Mock | æ²¡ç”¨TDDï¼Œä»£ç å…ˆè¡Œ | åˆ æ‰ä»£ç ï¼Œç”¨TDDé‡å†™ |
| æµ‹è¯•æ°¸è¿œé€šè¿‡ | Mockäº†ç›®æ ‡æ–¹æ³• | æ”¹ç”¨@InjectMocks |
| Mockå‚æ•°ä¸åŒ¹é… | ç¡¬ç¼–ç å‚æ•°å€¼ | ä½¿ç”¨any*()åŒ¹é…å™¨ |
| é…ç½®å€¼ä¸ºnull | å¿˜è®°Mocké…ç½®ç±» | æ·»åŠ configçš„Mock |
| cdå‘½ä»¤å¤±è´¥ | é‡å¤è¿›å…¥ç›®å½• | å…ˆpwdå†å†³å®š |
| æ—¶é—´æµ‹è¯•ä¸ç¨³å®š | ä¾èµ–å½“å‰æ—¶é—´ | å›ºå®šæ—¶é—´åŸºå‡†ç‚¹ |
| PotentialStubbingProblem | argThat()å¤æ‚å¯¹è±¡åŒ¹é…å¤±è´¥ | æ”¹ç”¨any()æˆ–eq() |
| æ„é€ å‡½æ•°å‚æ•°ä¸åŒ¹é… | æ–°å¢ä¾èµ–æœªæ›´æ–°æ‰€æœ‰æµ‹è¯• | grepæ‰¾å‡ºç›¸å…³æµ‹è¯•é€ä¸€ä¿®å¤ |
| UnfinishedVerificationException | verify()è¯­æ³•é”™è¯¯æˆ–NPEæ±¡æŸ“ | æ£€æŸ¥verify()è°ƒç”¨å’ŒMocké…ç½® |
| é›†æˆæµ‹è¯•Mockæ±¡æŸ“ | å‰é¢æµ‹è¯•çš„stubbingå½±å“åç»­ | ä½¿ç”¨lenient()æˆ–reset() |

## ğŸ“‹ å¼€å‘å‰å¿…æŸ¥æ¸…å•

### å¼€å§‹ä»»ä½•ç¼–ç å‰
- [ ] **TDDç¬¬ä¸€æ­¥**ï¼šå…ˆå†™ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•
- [ ] ç¡®è®¤æµ‹è¯•çœŸçš„å¤±è´¥äº†ï¼ˆğŸ”´ REDï¼‰
- [ ] å†™æœ€å°‘ä»£ç è®©æµ‹è¯•é€šè¿‡ï¼ˆğŸŸ¢ GREENï¼‰

### å†™æµ‹è¯•å‰
- [ ] è¯†åˆ«æ‰€æœ‰å¤–éƒ¨ä¾èµ–ï¼ˆRepositoryã€Configã€å¤–éƒ¨Serviceï¼‰
- [ ] ç¡®è®¤ç›®æ ‡æ–¹æ³•ä¸åœ¨Mockåˆ—è¡¨ä¸­
- [ ] å‡†å¤‡å‚æ•°åŒ¹é…ç­–ç•¥ï¼ˆç²¾ç¡®åŒ¹é… vs any*()ï¼‰

### è¿è¡Œæµ‹è¯•å‰
- [ ] ç¡®è®¤å½“å‰å·¥ä½œç›®å½•ï¼ˆpwdï¼‰
- [ ] é€‰æ‹©æ­£ç¡®çš„æµ‹è¯•èŒƒå›´ï¼ˆå•ä¸ªâ†’å±‚çº§â†’å…¨é‡ï¼‰
- [ ] æ£€æŸ¥Mocké…ç½®å®Œæ•´æ€§

### æµ‹è¯•å¤±è´¥å
- [ ] å…ˆçœ‹é”™è¯¯ç±»å‹ï¼ˆNPEï¼Ÿå‚æ•°ä¸åŒ¹é…ï¼Ÿæ–­è¨€å¤±è´¥ï¼Ÿï¼‰
- [ ] å¯¹ç…§é€ŸæŸ¥è¡¨å¿«é€Ÿå®šä½
- [ ] åªä¿®å¤ç›¸å…³ä»£ç ï¼Œä¸è¦ç›²ç›®å…¨æ”¹

## ğŸ¯ æ ¸å¿ƒåŸåˆ™ï¼ˆç²¾ç®€ç‰ˆï¼‰

1. **TDDå¼ºåˆ¶**ï¼šå¿…é¡»çº¢-ç»¿-é‡æ„å¾ªç¯ï¼Œä¸æ˜¯å»ºè®®æ˜¯å¼ºåˆ¶
2. **æµ‹è¯•çœŸå®æ€§**ï¼šMockä¾èµ–ï¼Œä¸Mockç›®æ ‡
3. **æ‰§è¡Œæ•ˆç‡**ï¼šå°èŒƒå›´ä¼˜å…ˆï¼Œé€æ­¥æ‰©å¤§
4. **é…ç½®å®Œæ•´**ï¼šæ‰€æœ‰@Mockå­—æ®µçš„æ–¹æ³•éƒ½è¦when()
5. **å‚æ•°çµæ´»**ï¼šä¼˜å…ˆç”¨any*()åŒ¹é…å™¨ï¼Œé™¤ééœ€è¦ç²¾ç¡®éªŒè¯
6. **æ—¶é—´ç¡®å®š**ï¼šæµ‹è¯•ä¸­çš„æ—¶é—´å¿…é¡»å¯æ§ï¼Œä¸èƒ½éšæœº

## ğŸ’¡ æ•ˆç‡æå‡æŠ€å·§

### 1. å¿«é€Ÿå®šä½æµ‹è¯•é—®é¢˜
```bash
# åªçœ‹å¤±è´¥çš„æµ‹è¯•è¾“å‡º
mvn test | grep -A 10 "FAILURE\|ERROR"
```

### 2. Mocké…ç½®æ¨¡æ¿
```java
@BeforeEach
void setUp() {
    // æ ‡å‡†åŒ–é…ç½®Mock
    when(config.getExpiringSoonDays()).thenReturn(30);
    when(config.getBatchSize()).thenReturn(100);
    // ä½¿ç”¨lenient()å¤„ç†å¯èƒ½ä¸è¢«è°ƒç”¨çš„Mock
    lenient().when(repository.count()).thenReturn(10L);
}
```

### 4. æ–°å¢ä¾èµ–æ—¶çš„ç³»ç»ŸåŒ–å¤„ç†
```bash
# æ­¥éª¤1ï¼šæŸ¥æ‰¾æ‰€æœ‰å—å½±å“çš„æµ‹è¯•
grep -r "MonitoringServiceImpl" backend/src/test/ --include="*.java"

# æ­¥éª¤2ï¼šæ‰¹é‡æ·»åŠ Mockå£°æ˜
# åœ¨æ¯ä¸ªæµ‹è¯•ç±»ä¸­æ·»åŠ ï¼š
@Mock private AlertRuleEngine alertRuleEngine;

# æ­¥éª¤3ï¼šæ›´æ–°æ„é€ å‡½æ•°æˆ–setUpæ–¹æ³•
# ä¿®æ”¹æ‰€æœ‰å®ä¾‹åŒ–ä»£ç 
monitoringService = new MonitoringServiceImpl(repo, service, config, logService, alertRuleEngine);

# æ­¥éª¤4ï¼šåˆ†å±‚éªŒè¯ä¿®å¤ç»“æœ
mvn test -Dtest="*MonitoringService*Test"  # åªæµ‹è¯•ç›¸å…³ç±»
```

### 3. æ‰¹é‡ä¿®å¤æµ‹è¯•
```java
// ä½¿ç”¨ @ParameterizedTest å‡å°‘é‡å¤ä»£ç 
@ParameterizedTest
@ValueSource(ints = {30, 15, 0, -5})
void testStatusCalculation(int daysUntilExpiry) {
    // ä¸€ä¸ªæµ‹è¯•æ–¹æ³•è¦†ç›–å¤šä¸ªåœºæ™¯
}
```

## âš ï¸ é¡¹ç›®ç‰¹å®šæ³¨æ„äº‹é¡¹

### åç«¯æ³¨æ„äº‹é¡¹
1. **Java 8 å…¼å®¹æ€§**ï¼šä¸è¦ä½¿ç”¨Java 9+çš„API
2. **Spring Bootæµ‹è¯•**ï¼šéœ€è¦@SpringBootTestçš„æµ‹è¯•æ›´æ…¢ï¼Œå°½é‡ç”¨çº¯å•å…ƒæµ‹è¯•
3. **MyBatisæµ‹è¯•**ï¼šRepositoryå±‚æµ‹è¯•å¯èƒ½éœ€è¦@MybatisTestæˆ–ä½¿ç”¨Mock

### å‰ç«¯æ³¨æ„äº‹é¡¹ï¼ˆVue 3 + Viteï¼‰
1. **Vue 3 è¿ç§»é™·é˜±é€ŸæŸ¥**
   ```javascript
   // âŒ Vue 2 å†™æ³•ï¼ˆä¼šæŠ¥é”™ï¼‰
   v-on="$listeners"  // Vue 3å·²ç§»é™¤
   this.$children     // Vue 3å·²ç§»é™¤
   Vue.filter()       // Vue 3å·²ç§»é™¤
   
   // âœ… Vue 3 æ­£ç¡®å†™æ³•
   // $listenerså·²åˆå¹¶åˆ°$attrsï¼Œä¸éœ€è¦æ˜¾å¼ä¼ é€’
   // ä½¿ç”¨provide/injectæ›¿ä»£$children
   // ä½¿ç”¨computedæˆ–æ–¹æ³•æ›¿ä»£filter
   ```

2. **æµ‹è¯•æ¡†æ¶é…ç½®ï¼ˆVitestï¼‰**
   ```javascript
   // âŒ é”™è¯¯ï¼šæµ‹è¯•æ— æ³•è§£æ@åˆ«å
   import { something } from '@/utils/request'  // æŠ¥é”™ï¼šCannot find module
   
   // âœ… è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿vitest.config.jsé…ç½®äº†åˆ«å
   resolve: {
     alias: {
       '@': fileURLToPath(new URL('./src', import.meta.url))
     }
   }
   ```

3. **ç¯å¢ƒå˜é‡å‰ç¼€**
   ```javascript
   // âŒ é”™è¯¯ï¼šç¯å¢ƒå˜é‡æ— æ³•è®¿é—®
   const apiUrl = import.meta.env.API_BASE_URL  // undefined
   
   // âœ… æ­£ç¡®ï¼šå¿…é¡»ä»¥VITE_å¼€å¤´
   const apiUrl = import.meta.env.VITE_API_BASE_URL  // æ­£å¸¸è®¿é—®
   ```

---

## ğŸ”„ æœ€è¿‘æ›´æ–°çš„å‘

### 2025-08-16 Story 1.5 å‰ç«¯æ¡†æ¶QAå®¡æŸ¥
- **é—®é¢˜1**ï¼šBaseTableç»„ä»¶ä½¿ç”¨äº†Vue 2çš„`$listeners`è¯­æ³•å¯¼è‡´Vue 3ä¸å…¼å®¹
- **åŸå› **ï¼šå¼€å‘æ—¶æœªæ³¨æ„Vue 2åˆ°Vue 3çš„ç ´åæ€§å˜æ›´
- **æ•™è®­**ï¼šå‰ç«¯æ¡†æ¶å‡çº§è¦æŸ¥é˜…è¿ç§»æŒ‡å—ï¼Œç‰¹åˆ«æ³¨æ„å·²ç§»é™¤çš„API
- **è§£å†³**ï¼šVue 3ä¸­`$listeners`å·²åˆå¹¶åˆ°`$attrs`ï¼Œåˆ é™¤`v-on="$listeners"`å³å¯

- **é—®é¢˜2**ï¼šVitestæµ‹è¯•æ— æ³•è¿è¡Œï¼ŒæŠ¥"Cannot find module '@/utils/request'"
- **åŸå› **ï¼šæµ‹è¯•é…ç½®ä¸­çš„æ¨¡å—åˆ«åè§£æé—®é¢˜
- **æ•™è®­**ï¼šæµ‹è¯•æ¡†æ¶éœ€è¦ç‹¬ç«‹é…ç½®è·¯å¾„åˆ«åï¼Œä¸ä¼šè‡ªåŠ¨ç»§æ‰¿vite.config.js
- **è§£å†³**ï¼šåœ¨vitest.config.jsä¸­æ˜¾å¼é…ç½®resolve.alias

### 2025-08-15 Story 1.4 QAå®¡æŸ¥
- **é—®é¢˜**ï¼š`CertificateStatusServiceTest`æµ‹è¯•å¤±è´¥
- **åŸå› **ï¼šæ²¡æœ‰Mock `certificateStatusConfig.getExpiringSoonDays()`
- **æ•™è®­**ï¼šé…ç½®ç±»çš„æ–¹æ³•è°ƒç”¨å®¹æ˜“è¢«å¿½ç•¥ï¼Œè¦ç‰¹åˆ«æ³¨æ„

### 2025-08-17 Story 2.2 é¢„è­¦è§„åˆ™å¼€å‘å¤ç›˜

#### é—®é¢˜1ï¼šMockitoä¸¥æ ¼æ¨¡å¼Mockå‚æ•°ä¸åŒ¹é…
- **ç—‡çŠ¶**ï¼š`PotentialStubbingProblem: Strict stubbing argument mismatch`
- **åŸå› **ï¼šä½¿ç”¨äº†å…·ä½“çš„`argThat(cert -> cert.getId().equals(20L))`ä½†å®é™…è°ƒç”¨æ—¶å‚æ•°ä¸å®Œå…¨åŒ¹é…
- **æ•™è®­**ï¼šå¤æ‚å¯¹è±¡æ¯”è¾ƒåœ¨MockéªŒè¯ä¸­ç»å¸¸å¤±è´¥ï¼Œåº”ä¼˜å…ˆä½¿ç”¨ç®€å•åŒ¹é…å™¨
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  ```java
  // âŒ å®¹æ˜“å¤±è´¥ï¼šå¯¹è±¡å±æ€§åŒ¹é…
  doThrow().when(service).method(argThat(cert -> cert.getId().equals(20L)));
  
  // âœ… æ›´ç¨³å®šï¼šä½¿ç”¨any()æˆ–eq()
  doThrow().when(service).method(any(Certificate.class));
  doThrow().when(service).method(eq(specificCertInstance));
  ```

#### é—®é¢˜2ï¼šé›†æˆæµ‹è¯•Mocké…ç½®æ±¡æŸ“
- **ç—‡çŠ¶**ï¼šå‰é¢æµ‹è¯•çš„Mocké…ç½®å½±å“åç»­æµ‹è¯•ï¼Œå¯¼è‡´å‚æ•°ä¸åŒ¹é…
- **åŸå› **ï¼šMockitoä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œæœªä½¿ç”¨çš„stubbingä¼šè¢«æ ‡è®°ä¸ºæ½œåœ¨é”™è¯¯
- **æ•™è®­**ï¼šé›†æˆæµ‹è¯•ä¸­Mocké…ç½®è¦ä¹ˆç²¾ç¡®åŒ¹é…ï¼Œè¦ä¹ˆä½¿ç”¨lenientæ¨¡å¼
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  ```java
  // æ–¹æ¡ˆ1ï¼šä½¿ç”¨lenientæ¨¡å¼
  lenient().when(mockService).method(any());
  
  // æ–¹æ¡ˆ2ï¼šç®€åŒ–Mockæ¡ä»¶
  when(mockService).method(any()).thenReturn(defaultValue);
  
  // æ–¹æ¡ˆ3ï¼šåœ¨@BeforeEachä¸­reset Mock
  @BeforeEach void setUp() { reset(mockService); }
  ```

#### é—®é¢˜3ï¼šæµ‹è¯•æ‰§è¡Œç­–ç•¥ä¸å½“
- **ç—‡çŠ¶**ï¼šä¸€æ¬¡æ€§è¿è¡Œå…¨é‡æµ‹è¯•ï¼Œå‘ç°å¤šä¸ªå¤±è´¥åéš¾ä»¥å¿«é€Ÿå®šä½
- **åŸå› **ï¼šæ²¡æœ‰æŒ‰ç…§åˆ†å±‚ç­–ç•¥é€æ­¥éªŒè¯åŠŸèƒ½
- **æ•™è®­**ï¼šæ–°åŠŸèƒ½å¼€å‘æ—¶åº”è¯¥ä»å•å…ƒæµ‹è¯•åˆ°é›†æˆæµ‹è¯•é€å±‚éªŒè¯
- **æœ€ä½³å®è·µ**ï¼š
  ```bash
  # æ­£ç¡®çš„æµ‹è¯•æ‰§è¡Œé¡ºåº
  mvn test -Dtest=AlertRuleEngineTest        # 1. æ ¸å¿ƒå•å…ƒæµ‹è¯•
  mvn test -Dtest=AlertRuleConfigServiceTest # 2. é…ç½®æœåŠ¡æµ‹è¯•  
  mvn test -Dtest=AlertRuleIntegrationTest   # 3. é›†æˆæµ‹è¯•
  mvn test -Dtest="*AlertRule*"              # 4. ç›¸å…³åŠŸèƒ½å…¨é‡æµ‹è¯•
  mvn test                                   # 5. æœ€åæ‰è·‘å®Œæ•´æµ‹è¯•
  ```

#### é—®é¢˜4ï¼šæµ‹è¯•å‘½åå’Œç»„ç»‡ç¼ºä¹ç³»ç»Ÿæ€§
- **ç—‡çŠ¶**ï¼šæµ‹è¯•æ–‡ä»¶å‘½åä¸ä¸€è‡´ï¼Œéš¾ä»¥å¿«é€Ÿæ‰¾åˆ°ç›¸å…³æµ‹è¯•
- **åŸå› **ï¼šæ²¡æœ‰ç»Ÿä¸€çš„æµ‹è¯•å‘½åè§„èŒƒ
- **æ•™è®­**ï¼šæµ‹è¯•å‘½ååº”è¯¥åæ˜ æµ‹è¯•å±‚çº§å’ŒåŠŸèƒ½èŒƒå›´
- **è§„èŒƒ**ï¼š
  ```java
  // å•å…ƒæµ‹è¯•ï¼šXxxTest.java
  AlertRuleEngineTest.java         // æµ‹è¯•AlertRuleEngineçš„ä¸šåŠ¡é€»è¾‘
  AlertRuleConfigServiceTest.java  // æµ‹è¯•é…ç½®æœåŠ¡CRUDæ“ä½œ
  
  // é›†æˆæµ‹è¯•ï¼šXxxIntegrationTest.java  
  AlertRuleIntegrationTest.java    // æµ‹è¯•ç»„ä»¶é—´åä½œ
  
  // åŠŸèƒ½æµ‹è¯•ï¼šXxxFunctionalTest.java
  MonitoringServiceFunctionalTest.java // æµ‹è¯•å®Œæ•´ä¸šåŠ¡æµç¨‹
  ```

#### é—®é¢˜5ï¼šMockä¾èµ–åˆ†æä¸å¤Ÿç³»ç»ŸåŒ–
- **ç—‡çŠ¶**ï¼šæ¼Mockäº†`AlertRuleEngine`ä¾èµ–ï¼Œå¯¼è‡´æ„é€ å‡½æ•°å‚æ•°ä¸åŒ¹é…
- **åŸå› **ï¼šæ·»åŠ æ–°ä¾èµ–æ—¶ï¼Œå¿˜è®°åœ¨æ‰€æœ‰ç›¸å…³æµ‹è¯•ä¸­æ·»åŠ å¯¹åº”çš„Mock
- **æ•™è®­**ï¼šæ¯æ¬¡ä¿®æ”¹æ„é€ å‡½æ•°æ—¶ï¼Œè¦ç³»ç»Ÿæ€§æ£€æŸ¥æ‰€æœ‰ç›¸å…³æµ‹è¯•
- **è§£å†³æµç¨‹**ï¼š
  ```bash
  # 1. æ‰¾å‡ºæ‰€æœ‰éœ€è¦æ›´æ–°çš„æµ‹è¯•æ–‡ä»¶
  grep -r "MonitoringServiceImpl" backend/src/test/
  
  # 2. é€ä¸ªæ–‡ä»¶æ·»åŠ æ–°çš„Mockä¾èµ–
  @Mock private AlertRuleEngine alertRuleEngine;
  
  # 3. åœ¨setUp()æˆ–æ„é€ å‡½æ•°è°ƒç”¨ä¸­æ·»åŠ æ–°å‚æ•°
  monitoringService = new MonitoringServiceImpl(..., alertRuleEngine);
  ```

---

*ä¼˜åŒ–åŸåˆ™ï¼šè®©LLMåœ¨30ç§’å†…æ‰¾åˆ°æ‰€éœ€ä¿¡æ¯ï¼Œè€Œä¸æ˜¯é˜…è¯»å†—é•¿è¯´æ˜*