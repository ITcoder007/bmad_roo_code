# 统一项目结构

## 概述

证书生命周期管理系统采用 monorepo 结构，将前端和后端代码放在同一个代码仓库中管理。这种结构便于统一版本控制、依赖管理和 CI/CD 流程，特别适合中小型团队开发。由于前端使用 Vue.js，后端使用 Java，二者技术栈差异较大，因此不设置共享代码，而是通过 API 接口进行通信。

## 项目结构

```
certificate-lifecycle-management/
├── .github/                    # CI/CD 工作流
│   └── workflows/
│       ├── ci.yaml
│       └── deploy.yaml
├── frontend/                   # 前端应用程序 (Vue.js)
│   ├── public/                 # 静态资源
│   │   ├── favicon.ico        # 网站图标
│   │   └── index.html         # HTML模板
│   ├── src/                   # 源代码
│   │   ├── api/               # API接口
│   │   │   ├── index.js       # API实例配置
│   │   │   ├── certificate.js # 证书相关API
│   │   │   ├── monitoring.js  # 监控相关API
│   │   │   └── system.js      # 系统相关API
│   │   ├── assets/            # 静态资源
│   │   │   ├── images/        # 图片资源
│   │   │   └── styles/        # 样式资源
│   │   │       ├── global.scss # 全局样式
│   │   │       ├── variables.scss # SCSS变量
│   │   │       └── mixins.scss  # SCSS混入
│   │   ├── components/       # 通用组件
│   │   │   ├── common/         # 通用组件
│   │   │   │   ├── BaseTable.vue      # 基础表格组件
│   │   │   │   ├── BaseForm.vue       # 基础表单组件
│   │   │   │   ├── BaseDialog.vue     # 基础对话框组件
│   │   │   │   ├── Loading.vue        # 加载组件
│   │   │   │   └── Pagination.vue     # 分页组件
│   │   │   ├── layout/        # 布局组件
│   │   │   │   ├── AppLayout.vue      # 应用布局
│   │   │   │   ├── Header.vue         # 页头组件
│   │   │   │   ├── Sidebar.vue        # 侧边栏组件
│   │   │   │   └── MainContent.vue    # 主内容区组件
│   │   │   └── business/      # 业务组件
│   │   │       ├── CertificateList.vue    # 证书列表组件
│   │   │       ├── CertificateDetail.vue  # 证书详情组件
│   │   │       ├── CertificateForm.vue    # 证书表单组件
│   │   │       ├── Dashboard.vue         # 仪表板组件
│   │   │       └── MonitoringLogList.vue # 监控日志列表组件
│   │   ├── composables/     # 组合式函数
│   │   │   ├── useApi.js     # API调用组合函数
│   │   │   ├── useTable.js   # 表格操作组合函数
│   │   │   ├── useForm.js    # 表单操作组合函数
│   │   │   ├── usePagination.js # 分页组合函数
│   │   │   └── useDebounce.js # 防抖组合函数
│   │   ├── directives/      # 自定义指令
│   │   │   ├── permission.js # 权限指令
│   │   │   └── loading.js    # 加载指令
│   │   ├── hooks/           # 钩子函数
│   │   │   ├── useAuth.js    # 认证钩子
│   │   │   ├── useCertificate.js # 证书钩子
│   │   │   └── useMonitoring.js # 监控钩子
│   │   ├── layouts/         # 布局
│   │   │   ├── DefaultLayout.vue # 默认布局
│   │   │   └── AuthLayout.vue    # 认证布局
│   │   ├── mixins/          # 混入
│   │   │   ├── validation.js # 验证混入
│   │   │   └── pagination.js # 分页混入
│   │   ├── plugins/         # 插件
│   │   │   ├── element-plus.js # Element Plus插件
│   │   │   ├── echarts.js    # ECharts插件
│   │   │   └── dayjs.js      # Day.js插件
│   │   ├── router/          # 路由配置
│   │   │   ├── index.js      # 路由实例
│   │   │   ├── modules/      # 路由模块
│   │   │   │   ├── certificate.js # 证书路由
│   │   │   │   ├── monitoring.js  # 监控路由
│   │   │   │   └── system.js      # 系统路由
│   │   │   └── guards.js    # 路由守卫
│   │   ├── stores/          # 状态管理
│   │   │   ├── index.js      # Pinia实例
│   │   │   ├── modules/      # 状态模块
│   │   │   │   ├── auth.js    # 认证状态
│   │   │   │   ├── certificate.js # 证书状态
│   │   │   │   ├── monitoring.js  # 监控状态
│   │   │   │   └── system.js  # 系统状态
│   │   │   └── composables/  # 状态组合函数
│   │   │       ├── useAuthStore.js    # 认证状态组合函数
│   │   │       ├── useCertificateStore.js # 证书状态组合函数
│   │   │       └── useMonitoringStore.js # 监控状态组合函数
│   │   ├── utils/           # 工具函数
│   │   │   ├── request.js    # 请求工具
│   │   │   ├── auth.js       # 认证工具
│   │   │   ├── validation.js # 验证工具
│   │   │   ├── date.js       # 日期工具
│   │   │   └── common.js     # 通用工具
│   │   ├── views/           # 页面视图
│   │   │   ├── auth/         # 认证页面
│   │   │   │   ├── Login.vue        # 登录页面
│   │   │   │   └── ForgotPassword.vue # 忘记密码页面
│   │   │   ├── certificate/  # 证书页面
│   │   │   │   ├── CertificateList.vue   # 证书列表页面
│   │   │   │   ├── CertificateDetail.vue # 证书详情页面
│   │   │   │   └── CertificateForm.vue   # 证书表单页面
│   │   │   ├── monitoring/   # 监控页面
│   │   │   │   ├── Dashboard.vue        # 仪表板页面
│   │   │   │   └── MonitoringLogList.vue # 监控日志列表页面
│   │   │   ├── system/       # 系统页面
│   │   │   │   ├── Profile.vue         # 个人资料页面
│   │   │   │   └── Settings.vue        # 系统设置页面
│   │   │   └── error/        # 错误页面
│   │   │       ├── NotFound.vue       # 404页面
│   │   │       ├── Forbidden.vue      # 403页面
│   │   │       └── ServerError.vue    # 500页面
│   │   ├── App.vue         # 根组件
│   │   └── main.js         # 应用入口
│   ├── tests/              # 测试文件
│   │   ├── unit/           # 单元测试
│   │   ├── e2e/            # 端到端测试
│   │   └── fixtures/      # 测试数据
│   ├── .env                # 环境变量
│   ├── .env.development    # 开发环境变量
│   ├── .env.production     # 生产环境变量
│   ├── .env.staging        # 预发布环境变量
│   ├── .eslintrc.js        # ESLint配置
│   ├── .prettierrc.js      # Prettier配置
│   ├── vite.config.js      # Vite配置
│   ├── package.json        # 项目依赖
│   └── README.md           # 项目说明
├── backend/                # 后端应用程序 (Spring Boot)
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/
│   │   │   │   └── com/
│   │   │   │       └── example/
│   │   │   │           └── certificate/
│   │   │   │               ├── CertificateManagementApplication.java # 应用入口
│   │   │   │               ├── config/                                    # 配置类
│   │   │   │               │   ├── DatabaseConfig.java                   # 数据库配置
│   │   │   │               │   ├── SecurityConfig.java                   # 安全配置
│   │   │   │               │   ├── WebConfig.java                        # Web配置
│   │   │   │               │   ├── SwaggerConfig.java                    # Swagger配置
│   │   │   │               │   ├── CacheConfig.java                      # 缓存配置
│   │   │   │               │   └── SchedulerConfig.java                 # 定时任务配置
│   │   │   │               ├── common/                                   # 通用模块
│   │   │   │               │   ├── constant/                             # 常量
│   │   │   │               │   ├── exception/                            # 异常处理
│   │   │   │               │   ├── response/                             # 响应封装
│   │   │   │               │   ├── util/                                 # 工具类
│   │   │   │               │   └── annotation/                           # 自定义注解
│   │   │   │               ├── controller/                              # 控制器层
│   │   │   │               │   ├── CertificateController.java            # 证书控制器
│   │   │   │               │   ├── MonitoringLogController.java         # 监控日志控制器
│   │   │   │               │   └── SystemController.java                 # 系统控制器
│   │   │   │               ├── service/                                 # 服务层
│   │   │   │               │   ├── dto/                                 # 数据传输对象
│   │   │   │               │   ├── vo/                                  # 视图对象
│   │   │   │               │   ├── mapper/                              # 对象映射器
│   │   │   │               │   ├── CertificateService.java              # 证书服务接口
│   │   │   │               │   ├── CertificateServiceImpl.java         # 证书服务实现
│   │   │   │               │   ├── MonitoringLogService.java           # 监控日志服务接口
│   │   │   │               │   ├── MonitoringLogServiceImpl.java        # 监控日志服务实现
│   │   │   │               │   ├── MonitoringService.java              # 监控服务接口
│   │   │   │               │   ├── MonitoringServiceImpl.java         # 监控服务实现
│   │   │   │               │   ├── AlertService.java                   # 预警服务接口
│   │   │   │               │   ├── AlertServiceImpl.java                # 预警服务实现
│   │   │   │               │   ├── SystemStatusService.java            # 系统状态服务接口
│   │   │   │               │   └── SystemStatusServiceImpl.java         # 系统状态服务实现
│   │   │   │               ├── domain/                                  # 领域层
│   │   │   │               │   ├── model/                              # 领域模型
│   │   │   │               │   ├── repository/                          # 仓库接口
│   │   │   │               │   ├── service/                            # 领域服务
│   │   │   │               │   └── event/                              # 领域事件
│   │   │   │               ├── infrastructure/                          # 基础设施层
│   │   │   │               │   ├── repository/impl/                     # 仓库实现
│   │   │   │               │   ├── persistence/                        # 持久化
│   │   │   │               │   ├── external/                           # 外部服务
│   │   │   │               │   ├── config/                            # 基础设施配置
│   │   │   │               │   └── scheduler/                         # 定时任务
│   │   │   │               └── security/                              # 安全模块
│   │   │   └── resources/
│   │   │       ├── application.yml                              # 应用配置
│   │   │       ├── application-dev.yml                          # 开发环境配置
│   │   │       ├── application-prod.yml                         # 生产环境配置
│   │   │       ├── application-test.yml                         # 测试环境配置
│   │   │       ├── mapper/                                      # MyBatis映射文件
│   │   │       ├── db/migration/                                # 数据库迁移脚本
│   │   │       ├── static/                                      # 静态资源
│   │   │       └── templates/                                   # 模板文件
│   │   └── test/
│   │       ├── java/
│   │       │   └── com/example/certificate/                     # 测试类
│   │       └── resources/
│   │           ├── application-test.yml                        # 测试环境配置
│   │           └── test-data/                                  # 测试数据
│   ├── .gitignore
│   ├── Dockerfile
│   ├── pom.xml
│   └── README.md
├── infrastructure/         # IaC 定义
│   └── docker/             # Docker 配置
│       ├── web/
│       │   └── Dockerfile
│       ├── api/
│       │   └── Dockerfile
│       └── docker-compose.yml
├── scripts/                # 构建和部署脚本
│   ├── build.sh
│   ├── deploy.sh
│   └── setup.sh
├── docs/                   # 文档
│   ├── prd.md
│   ├── architecture/
│   │   ├── README.md
│   │   ├── high-level-architecture.md
│   │   ├── tech-stack.md
│   │   ├── data-models.md
│   │   ├── api-specs.md
│   │   ├── components.md
│   │   ├── external-apis.md
│   │   ├── core-workflows.md
│   │   ├── database-schema.md
│   │   ├── frontend-architecture.md
│   │   ├── backend-architecture.md
│   │   └── unified-project-structure.md
│   └── front-end-spec.md
├── .env.example            # 环境变量模板
├── package.json            # 根 package.json（用于前端工作区管理）
└── README.md
```

## 目录结构说明

### frontend 目录 - Vue.js 前端应用程序

前端应用程序使用 Vue 3 + Vite + Element Plus 技术栈，目录结构与 `frontend-architecture.md` 中定义的结构保持一致：

- `src/api/`: API 接口封装，使用 Axios 处理 HTTP 请求
- `src/components/`: 组件库，分为通用组件、布局组件和业务组件
- `src/composables/`: Vue 3 组合式函数，用于复用状态逻辑
- `src/directives/`: 自定义指令，如权限指令和加载指令
- `src/hooks/`: 自定义钩子函数
- `src/layouts/`: 布局组件
- `src/mixins/`: 混入，用于复用组件逻辑
- `src/plugins/`: 插件配置，如 Element Plus、ECharts 等
- `src/router/`: Vue Router 路由配置
- `src/stores/`: Pinia 状态管理
- `src/utils/`: 工具函数库
- `src/views/`: 页面视图组件
- `tests/`: 测试文件，包括单元测试和端到端测试

### backend 目录 - Spring Boot 后端应用程序

后端应用程序使用 Spring Boot + MyBatis Plus + MySQL 技术栈，目录结构与 `backend-architecture.md` 中定义的结构保持一致：

- `src/main/java/com/example/certificate/config/`: 配置类，包括数据库、安全、Web等配置
- `src/main/java/com/example/certificate/common/`: 通用模块，包括常量、异常处理、响应封装等
- `src/main/java/com/example/certificate/controller/`: 控制器层，处理 HTTP 请求和响应
- `src/main/java/com/example/certificate/service/`: 服务层，实现业务逻辑
- `src/main/java/com/example/certificate/domain/`: 领域层，包含核心业务逻辑和领域模型
- `src/main/java/com/example/certificate/infrastructure/`: 基础设施层，实现仓库接口和外部服务集成
- `src/main/java/com/example/certificate/security/`: 安全模块，实现 JWT 认证和授权
- `src/main/resources/`: 资源文件，包括配置文件、MyBatis映射文件、数据库迁移脚本等
- `src/test/`: 测试文件，包括单元测试和集成测试

### infrastructure 目录

包含基础设施即代码（IaC）定义，主要用于容器化部署：
- `docker/web/Dockerfile`: 前端应用容器化配置
- `docker/api/Dockerfile`: 后端应用容器化配置
- `docker/docker-compose.yml`: 本地开发环境配置

### scripts 目录

包含构建和部署脚本：
- `build.sh`: 构建脚本
- `deploy.sh`: 部署脚本
- `setup.sh`: 环境设置脚本

### docs 目录

项目文档，包括：
- 产品需求文档 (PRD)
- 架构设计文档（分片存储）
- 前端规格说明

## Monorepo 管理工具

项目使用以下工具进行 monorepo 管理：

### 根级别配置

**package.json** - 管理 JavaScript/TypeScript 相关依赖和脚本，主要用于前端工作区管理
```json
{
  "name": "certificate-lifecycle-management",
  "private": true,
  "scripts": {
    "build": "cd frontend && npm run build",
    "test": "cd frontend && npm test",
    "dev": "concurrently \"npm run dev:web\" \"npm run dev:api\"",
    "dev:web": "cd frontend && npm run dev",
    "dev:api": "cd backend && mvn spring-boot:run",
    "lint": "cd frontend && npm run lint",
    "format": "cd frontend && npm run format"
  },
  "devDependencies": {
    "concurrently": "^7.6.0"
  }
}
```

**backend/pom.xml** - 管理 Java 相关依赖和构建
```xml
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    
    <groupId>com.example</groupId>
    <artifactId>certificate-lifecycle-management-backend</artifactId>
    <version>1.0.0</version>
    <packaging>jar</packaging>
    
    <properties>
        <maven.compiler.source>8</maven.compiler.source>
        <maven.compiler.target>8</maven.compiler.target>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    </properties>
    
    <!-- 依赖管理 -->
</project>
```

## 前后端通信方式

由于前端使用 Vue.js，后端使用 Java，二者技术栈差异较大，因此不设置共享代码，而是通过 RESTful API 进行通信：

### API 设计原则

- **RESTful 风格**：遵循 RESTful API 设计原则
- **统一响应格式**：所有 API 响应使用统一的 JSON 格式
- **状态码规范**：使用 HTTP 状态码表示请求结果
- **版本控制**：通过 URL 路径进行 API 版本控制
- **认证授权**：使用 JWT 进行 API 认证和授权

### API 接口示例

```javascript
// 前端 API 调用示例
import api from '@/api'

// 获取证书列表
export function getCertificateList(params) {
  return api.get('/api/v1/certificates', { params })
}

// 获取证书详情
export function getCertificateDetail(id) {
  return api.get(`/api/v1/certificates/${id}`)
}

// 创建证书
export function createCertificate(data) {
  return api.post('/api/v1/certificates', data)
}

// 更新证书
export function updateCertificate(id, data) {
  return api.put(`/api/v1/certificates/${id}`, data)
}

// 删除证书
export function deleteCertificate(id) {
  return api.delete(`/api/v1/certificates/${id}`)
}
```

## 开发工作流程

### 本地开发

1. **环境设置**
   ```bash
   # 克隆仓库
   git clone <repository-url>
   cd certificate-lifecycle-management
   
   # 安装前端依赖
   cd frontend && npm install
   cd ..
   
   # 设置后端依赖
   cd backend && mvn install
   cd ..
   ```

2. **启动开发服务器**
   ```bash
   # 同时启动前端和后端
   npm run dev
   
   # 或分别启动
   npm run dev:web  # 前端开发服务器
   npm run dev:api  # 后端开发服务器
   ```

### 代码协作流程

1. **前后端分离开发**：前端和后端可以并行开发，通过 API 契约进行协作
2. **API 文档**：使用 Swagger/OpenAPI 生成 API 文档，确保前后端对 API 接口有一致的理解
3. **Mock 数据**：前端开发时可以使用 Mock 数据，不依赖后端服务
4. **代码审查**：前后端代码分别进行审查，确保代码质量

### 构建和部署

1. **构建应用**
   ```bash
   # 构建前端
   cd frontend && npm run build
   
   # 构建后端
   cd backend && mvn clean package
   ```

2. **容器化部署**
   ```bash
   # 构建镜像
   docker build -f infrastructure/docker/web/Dockerfile -t clm-web:latest .
   docker build -f infrastructure/docker/api/Dockerfile -t clm-api:latest .
   
   # 使用 Docker Compose 启动
   docker-compose -f infrastructure/docker/docker-compose.yml up -d
   ```

## 优势与考虑

### Monorepo 优势

1. **统一版本控制**：前后端代码在同一个仓库中，版本管理更加一致
2. **依赖管理**：可以轻松管理跨应用依赖
3. **重构便利**：跨应用重构更加容易
4. **CI/CD 简化**：统一的构建和部署流程
5. **代码复用**：虽然前后端技术栈不同，但可以共享文档、配置和脚本

### 注意事项

1. **构建时间**：Monorepo 可能会增加构建时间，需要合理配置并行构建
2. **权限管理**：需要明确团队成员对不同模块的访问权限
3. **代码组织**：需要良好的目录结构和命名约定
4. **工具链配置**：需要配置适合多项目的工具链
5. **前后端分离**：由于技术栈差异，前后端代码完全分离，通过 API 进行通信

这种统一的项目结构为证书生命周期管理系统提供了清晰的组织方式，支持前后端协同开发，并为未来的扩展和维护奠定了良好基础。